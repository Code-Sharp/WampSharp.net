<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate href=/index.xml type=application/rss+xml title=WampSharp><link rel=icon href=https://wampsharp.net/favicon.ico><title>Reflection-based Caller - WampSharp</title><link rel=stylesheet href=https://wampsharp.net/css/highlight/github.css><link rel=stylesheet href=https://wampsharp.net/css/bootstrap.min.css><link rel=stylesheet href=https://wampsharp.net/css/bootstrap-theme.min.css><link rel=stylesheet href=https://wampsharp.net/css/theme.css><link rel=stylesheet href=https://wampsharp.net/css/bootie-docs.css><link rel=stylesheet href=https://wampsharp.net/css/site.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@v2.6.3/dist/cdn/docsearch.min.css></head><body role=document><nav class="navbar navbar-inverse navbar-fixed-top"><div class=container><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#navbar aria-expanded=false aria-controls=navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://wampsharp.net/>WampSharp</a></div><div id=navbar class="navbar-collapse collapse"><ul class="nav navbar-nav"><li><a href=https://wampsharp.net/>Home</a></li><li class=dropdown><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-expanded=false>Categories<span class=caret></span></a><ul class=dropdown-menu role=menu><li><a href=https://wampsharp.net/categories/authentication>Authentication</a></li><li><a href=https://wampsharp.net/categories/callee>Callee</a></li><li><a href=https://wampsharp.net/categories/caller>Caller</a></li><li><a href=https://wampsharp.net/categories/client>Client</a></li><li><a href=https://wampsharp.net/categories/getting-started>Getting-Started</a></li><li><a href=https://wampsharp.net/categories/publisher>Publisher</a></li><li><a href=https://wampsharp.net/categories/release-notes>Release-Notes</a></li><li><a href=https://wampsharp.net/categories/roadmap>Roadmap</a></li><li><a href=https://wampsharp.net/categories/router>Router</a></li><li><a href=https://wampsharp.net/categories/subscriber>Subscriber</a></li><li><a href=https://wampsharp.net/categories/wamp1>Wamp1</a></li></ul></li></ul><form class="navbar-form navbar-left" role=search><div class="input-group doc-search-form"><input type=text id=as_q class="search-query doc-search-input-text" placeholder="Search Site"></div></form></div></div></nav><div class=container><div class=row><div class="col-sm-8 doc-main"><main role=main><article><a id=title></a><h1 class=doc-entry-title>Reflection-based Caller</h1><div class=doc-entry-meta><span><time datetime=2017-07-30>July 30, 2017</time></span></div><section><p><strong>Reflection-based Caller</strong> (or <strong>&ldquo;Callee proxy&rdquo;</strong>) allows you to call callee methods of a WAMP realm, by declaring an interface with methods decorated with a [WampProcedure] attribute.</p><p>The interface must be public.</p><h2 id=basic-usage>Basic usage</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> IArgumentsService
{
<span style=color:#a6e22e>    [WampProcedure(&#34;com.arguments.add2&#34;)]</span>
    <span style=color:#66d9ef>int</span> Add2(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> b);
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> Task Main()
{
    DefaultWampChannelFactory factory =
        <span style=color:#66d9ef>new</span> DefaultWampChannelFactory();

    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>string</span> serverAddress = <span style=color:#e6db74>&#34;ws://127.0.0.1:8080/ws&#34;</span>;

    IWampChannel channel =
        factory.CreateJsonChannel(serverAddress, <span style=color:#e6db74>&#34;realm1&#34;</span>);

    <span style=color:#66d9ef>await</span> channel.Open().ConfigureAwait(<span style=color:#66d9ef>false</span>);

    <span style=color:#75715e>// This line is required in order to release the WebSocket thread, otherwise it will be blocked by the following synchronous proxy.Add2(2,3) call.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>await</span> Task.Yield();

    IArgumentsService proxy =
        channel.RealmProxy.Services.GetCalleeProxy&lt;IArgumentsService&gt;();

    <span style=color:#66d9ef>int</span> five = proxy.Add2(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>);
}
</code></pre></div><h2 id=supported-features>Supported features</h2><p>The following features are supported:</p><h3 id=async-method-support>Async method support</h3><p>A method returning a Task&lt;> can be awaited. Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> IArgumentsServiceProxy
{
<span style=color:#a6e22e>    [WampProcedure(&#34;com.arguments.ping&#34;)]</span>
    Task PingAsync();
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [WampProcedure(&#34;com.arguments.add2&#34;)]</span>
    Task&lt;<span style=color:#66d9ef>int</span>&gt; Add2Async(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> b);
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [WampProcedure(&#34;com.arguments.stars&#34;)]</span>
    Task&lt;<span style=color:#66d9ef>string</span>&gt; StarsAsync(<span style=color:#66d9ef>string</span> nick = <span style=color:#e6db74>&#34;somebody&#34;</span>, <span style=color:#66d9ef>int</span> stars = <span style=color:#ae81ff>0</span>);
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [WampProcedure(&#34;com.arguments.orders&#34;)]</span>
    Task&lt;<span style=color:#66d9ef>string</span>[]&gt; OrdersAsync(<span style=color:#66d9ef>string</span> product, <span style=color:#66d9ef>int</span> limit = <span style=color:#ae81ff>5</span>);
}
</code></pre></div><p>Call example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> Task Main()
{
    DefaultWampChannelFactory factory = <span style=color:#66d9ef>new</span> DefaultWampChannelFactory();

    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>string</span> serverAddress = <span style=color:#e6db74>&#34;ws://127.0.0.1:8080/ws&#34;</span>;

    IWampChannel channel =
        factory.CreateJsonChannel(serverAddress, <span style=color:#e6db74>&#34;realm1&#34;</span>);

    <span style=color:#66d9ef>await</span> channel.Open().ConfigureAwait(<span style=color:#66d9ef>false</span>);

    IArgumentsServiceProxy proxy =
        channel.RealmProxy.Services.GetCalleeProxy&lt;IArgumentsServiceProxy&gt;();

    <span style=color:#66d9ef>await</span> proxy.PingAsync().ConfigureAwait(<span style=color:#66d9ef>false</span>);
    Console.WriteLine(<span style=color:#e6db74>&#34;Pinged!&#34;</span>);

    <span style=color:#66d9ef>int</span> result = <span style=color:#66d9ef>await</span> proxy.Add2Async(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
    Console.WriteLine(<span style=color:#e6db74>&#34;Add2: {0}&#34;</span>, result);

    <span style=color:#66d9ef>var</span> starred = <span style=color:#66d9ef>await</span> proxy.StarsAsync().ConfigureAwait(<span style=color:#66d9ef>false</span>);
    Console.WriteLine(<span style=color:#e6db74>$&#34;Starred 1: {starred}&#34;</span>);

    starred = <span style=color:#66d9ef>await</span> proxy.StarsAsync(nick: <span style=color:#e6db74>&#34;Homer&#34;</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
    Console.WriteLine(<span style=color:#e6db74>$&#34;Starred 2: {starred}&#34;</span>);

    starred = <span style=color:#66d9ef>await</span> proxy.StarsAsync(stars: <span style=color:#ae81ff>5</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
    Console.WriteLine(<span style=color:#e6db74>$&#34;Starred 3: {starred}&#34;</span>);

    starred = <span style=color:#66d9ef>await</span> proxy.StarsAsync(nick: <span style=color:#e6db74>&#34;Homer&#34;</span>, stars: <span style=color:#ae81ff>5</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
    Console.WriteLine(<span style=color:#e6db74>$&#34;Starred 4: {starred}&#34;</span>);

    <span style=color:#66d9ef>string</span>[] orders = <span style=color:#66d9ef>await</span> proxy.OrdersAsync(<span style=color:#e6db74>&#34;coffee&#34;</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
    Console.WriteLine(<span style=color:#e6db74>$&#34;Orders 1: {string.Join(&#34;</span>, <span style=color:#e6db74>&#34;, orders)}&#34;</span>);

    orders = <span style=color:#66d9ef>await</span> proxy.OrdersAsync(<span style=color:#e6db74>&#34;coffee&#34;</span>, limit: <span style=color:#ae81ff>10</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
    Console.WriteLine(<span style=color:#e6db74>$&#34;Orders 2: {string.Join(&#34;</span>, <span style=color:#e6db74>&#34;, orders)}&#34;</span>);
}
</code></pre></div><blockquote><p>Note: The sample is based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/rpc/arguments>this</a> AutobahnJS sample</p></blockquote><h3 id=tuples-support>Tuples support</h3><p>Reflection-based callers support C# 7.0 tuple return values. You can simply declare a method returning a C# 7.0 tuple in your callee proxy interface. The tuple will be deserialized either from the arguments keywords or from the arguments array of the RESULT message, depending on whether the returned tuple has named elements or positional elements. (tuples having elements which are partially named are not supported)</p><p>For example, declare the following callee proxy interface:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> IComplexResultServiceProxy
{
<span style=color:#a6e22e>	[WampProcedure(&#34;com.myapp.add_complex&#34;)]</span>
	Task&lt;(<span style=color:#66d9ef>int</span> c, <span style=color:#66d9ef>int</span> ci)&gt; AddComplexAsync(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> ai, <span style=color:#66d9ef>int</span> b, <span style=color:#66d9ef>int</span> bi);
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>	[WampProcedure(&#34;com.myapp.split_name&#34;)]</span>
    Task&lt;(<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>)&gt; SplitNameAsync(<span style=color:#66d9ef>string</span> fullname);
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.add_complex&#34;)]</span>
    (<span style=color:#66d9ef>int</span> c, <span style=color:#66d9ef>int</span> ci) AddComplex(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> ai, <span style=color:#66d9ef>int</span> b, <span style=color:#66d9ef>int</span> bi);
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.split_name&#34;)]</span>
    (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>) SplitName(<span style=color:#66d9ef>string</span> fullname);
}
</code></pre></div><p>And then obtain a callee proxy and simply call its methods:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> Task Main()
{
    DefaultWampChannelFactory factory = <span style=color:#66d9ef>new</span> DefaultWampChannelFactory();

    IWampChannel channel =
        factory.CreateJsonChannel(<span style=color:#e6db74>&#34;ws://localhost:8080/ws&#34;</span>, <span style=color:#e6db74>&#34;realm1&#34;</span>);

    <span style=color:#66d9ef>await</span> channel.Open().ConfigureAwait(<span style=color:#66d9ef>false</span>);

    IComplexResultServiceProxy proxy =
        channel.RealmProxy.Services.GetCalleeProxy&lt;IComplexResultServiceProxy&gt;();

    (<span style=color:#66d9ef>string</span> forename, <span style=color:#66d9ef>string</span> surname) = <span style=color:#66d9ef>await</span> proxy.SplitNameAsync(<span style=color:#e6db74>&#34;Homer Simpson&#34;</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
    <span style=color:#75715e>// Synchronous version: 
</span><span style=color:#75715e></span>    <span style=color:#75715e>// (string forename, string surname) = proxy.SplitName(&#34;Homer Simpson&#34;);
</span><span style=color:#75715e></span>
    Console.WriteLine(<span style=color:#e6db74>$&#34;Forename: {forename}, Surname: {surname}&#34;</span>);

    (<span style=color:#66d9ef>int</span> c, <span style=color:#66d9ef>int</span> ci) = <span style=color:#66d9ef>await</span> proxy.AddComplexAsync(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
    <span style=color:#75715e>// Synchronous version: 
</span><span style=color:#75715e></span>    <span style=color:#75715e>// (int c, int ci) = proxy.AddComplex(2, 3, 4, 5);
</span><span style=color:#75715e></span>
    Console.WriteLine(<span style=color:#e6db74>$&#34;Result: {c} + {ci}i&#34;</span>);
}
</code></pre></div><p>This code can consume the following code written in Javascript:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>add_complex</span>(<span style=color:#a6e22e>args</span>, <span style=color:#a6e22e>kwargs</span>) {
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>autobahn</span>.<span style=color:#a6e22e>Result</span>([], {<span style=color:#a6e22e>c</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>ci</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>3</span>]});
}

<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>split_name</span>(<span style=color:#a6e22e>args</span>) {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>splitted</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34; &#34;</span>);
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>forename</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>splitted</span>[<span style=color:#ae81ff>0</span>];
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>surname</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>splitted</span>[<span style=color:#ae81ff>1</span>];
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>autobahn</span>.<span style=color:#a6e22e>Result</span>([<span style=color:#a6e22e>forename</span>, <span style=color:#a6e22e>surname</span>]);
}

<span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>register</span>(<span style=color:#e6db74>&#39;com.myapp.add_complex&#39;</span>, <span style=color:#a6e22e>add_complex</span>).<span style=color:#a6e22e>then</span>(
    <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>registration</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Procedure registered:&#34;</span>, <span style=color:#a6e22e>registration</span>.<span style=color:#a6e22e>id</span>);
    },
    <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Registration failed:&#34;</span>, <span style=color:#a6e22e>error</span>);
    }
);

<span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>register</span>(<span style=color:#e6db74>&#39;com.myapp.split_name&#39;</span>, <span style=color:#a6e22e>split_name</span>).<span style=color:#a6e22e>then</span>(
    <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>registration</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Procedure registered:&#34;</span>, <span style=color:#a6e22e>registration</span>.<span style=color:#a6e22e>id</span>);
    },
    <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Registration failed:&#34;</span>, <span style=color:#a6e22e>error</span>);
    }
);
</code></pre></div><blockquote><p>Note: The samples are based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/rpc/complex>this</a> AutobahnJS/AutobahnPython sample</p></blockquote><h3 id=exception-support>Exception support</h3><p>You can catch a WampException in order to treat a ERROR message.</p><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>try</span>
{
    <span style=color:#66d9ef>await</span> proxy.CheckNameAsync(<span style=color:#e6db74>&#34;Moses Montefiore&#34;</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
}
<span style=color:#66d9ef>catch</span> (WampException ex)
{
    <span style=color:#66d9ef>string</span> errorUri = ex.ErrorUri; <span style=color:#75715e>// &#34;com.myapp.error.invalid_length&#34;
</span><span style=color:#75715e></span>    IDictionary&lt;<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>object</span>&gt; arguments = ex.ArgumentsKeywords; <span style=color:#75715e>// {&#34;min&#34;: 3, &#34;max&#34;: 10}
</span><span style=color:#75715e></span>}
</code></pre></div><blockquote><p>Note: The sample is based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/rpc/errors>this</a> AutobahnJS sample</p></blockquote><h3 id=progressive-call-results>Progressive call results</h3><p>In order to use progressive call results as a Caller, declare in your callee service a [WampProcedure] method having a [WampProgressiveResultProcedure] attribute and a IProgress&lt;T> as the last parameter.</p><blockquote><p>Note that the method return type should be Task&lt;T> where this is the same T as in the IProgress&lt;T> of the last parameter.</p></blockquote><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> ILongOpService
{
<span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.longop&#34;)]</span>
<span style=color:#a6e22e>    [WampProgressiveResultProcedure]</span>
    Task&lt;<span style=color:#66d9ef>int</span>&gt; LongOp(<span style=color:#66d9ef>int</span> n, IProgress&lt;<span style=color:#66d9ef>int</span>&gt; progress);
}
</code></pre></div><p>Then obtain the proxy and call it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> Task Main()
{
    DefaultWampChannelFactory factory = <span style=color:#66d9ef>new</span> DefaultWampChannelFactory();

    IWampChannel channel = factory.CreateJsonChannel(<span style=color:#e6db74>&#34;ws://localhost:8080/ws&#34;</span>, <span style=color:#e6db74>&#34;realm1&#34;</span>);

    <span style=color:#66d9ef>await</span> channel.Open()ConfigureAwait(<span style=color:#66d9ef>false</span>);

    ILongOpService proxy = channel.RealmProxy.Services.GetCalleeProxy&lt;ILongOpService&gt;();

    Progress&lt;<span style=color:#66d9ef>int</span>&gt; progress =
        <span style=color:#66d9ef>new</span> Progress&lt;<span style=color:#66d9ef>int</span>&gt;(i =&gt; Console.WriteLine(<span style=color:#e6db74>&#34;Got progress &#34;</span> + i));

    <span style=color:#66d9ef>int</span> result = <span style=color:#66d9ef>await</span> proxy.LongOp(<span style=color:#ae81ff>10</span>, progress).ConfigureAwait(<span style=color:#66d9ef>false</span>);

    Console.WriteLine(<span style=color:#e6db74>&#34;Got result &#34;</span> + result);
}
</code></pre></div><blockquote><p>Note: The sample is based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/rpc/progress>this</a> AutobahnJS sample</p></blockquote><h3 id=cancellation-support>Cancellation support</h3><p>Cancellation is supported via the <a href="https://msdn.microsoft.com/en-us/library/system.threading.cancellationtoken(v=vs.110).aspx">CancellationToken api</a>. In order to cancel a pending rpc invocation from a WAMP caller using the callee proxy api, declare an interface containing an async method, receiving a CancellationToken as its last parameter:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> ICancellableOpService
{
<span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.cancellableop&#34;)]</span>
    Task&lt;<span style=color:#66d9ef>int</span>&gt; CancellableOp(<span style=color:#66d9ef>int</span> n, CancellationToken token);
}
</code></pre></div><p>Then pass a CancellationToken to the method call, this is usually done using CancellationTokenSource. Call CancellationTokenSource.Cancel in order to cancel the invocation.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>ICancellableOpService proxy =
    channel.RealmProxy.Services.GetCalleeProxy&lt;ICancellableOpService&gt;();

CancellationTokenSource cancellationTokenSource = <span style=color:#66d9ef>new</span> CancellationTokenSource();

Task&lt;<span style=color:#66d9ef>int</span>&gt; invocationTask = proxy.CancellableOp(<span style=color:#ae81ff>4096</span>, cancellationTokenSource.Token);

<span style=color:#75715e>// Cancel the operation
</span><span style=color:#75715e></span>cancellationTokenSource.Cancel();

<span style=color:#66d9ef>await</span> invocationTask.ConfigureAwait(<span style=color:#66d9ef>false</span>);
</code></pre></div><blockquote><p><strong>Note</strong>: This works also with progressive call results:</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> ILongCancellableOpService
{
<span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.cancellableop&#34;)]</span>
    Task&lt;<span style=color:#66d9ef>int</span>&gt; LongCancellableOp(<span style=color:#66d9ef>int</span> n, IProgress&lt;<span style=color:#66d9ef>int</span>&gt; progress, CancellationToken token);
}
</code></pre></div><blockquote><p>Cancellation:</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>ILongCancellableOpService proxy =
    channel.RealmProxy.Services.GetCalleeProxy&lt;ILongCancellableOpService&gt;();

CancellationTokenSource cancellationTokenSource = <span style=color:#66d9ef>new</span> CancellationTokenSource();

Task&lt;<span style=color:#66d9ef>int</span>&gt; invocationTask = proxy.LongCancellableOp(<span style=color:#ae81ff>4096</span>, <span style=color:#66d9ef>new</span> MyProgress(), cancellationTokenSource.Token);

<span style=color:#75715e>// Cancel the operation
</span><span style=color:#75715e></span>cancellationTokenSource.Cancel();

<span style=color:#66d9ef>await</span> invocationTask.ConfigureAwait(<span style=color:#66d9ef>false</span>);
</code></pre></div><h3 id=outref-parameters>out/ref parameters</h3><p>For synchronous methods, out/ref parameters are supported.</p><blockquote><p>Note: this is not supported for asynchronous methods.</p></blockquote><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> IComplexResultService
{
<span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.add_complex&#34;)]</span>
    <span style=color:#66d9ef>void</span> AddComplex(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> ai, <span style=color:#66d9ef>int</span> b, <span style=color:#66d9ef>int</span> bi, <span style=color:#66d9ef>out</span> <span style=color:#66d9ef>int</span> c, <span style=color:#66d9ef>out</span> <span style=color:#66d9ef>int</span> ci);
}
</code></pre></div><p>Call example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>int</span> ci;
<span style=color:#66d9ef>int</span> c;
proxy.AddComplex(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>, <span style=color:#66d9ef>out</span> c, <span style=color:#66d9ef>out</span>  ci);
</code></pre></div><blockquote><p>Note: The sample is based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/rpc/complex>this</a> AutobahnJS sample</p></blockquote><h3 id=multi-valued-results>Multi-valued results</h3><p>In order to get an multivalued array from the RESULT/YIELD WAMPv2 message, set the return value of the rpc method to an array and place above it a [return: WampResult(CollectionResultTreatment.Multivalued)] attribute. Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> IMultivaluedResultService
{
<span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.split_name&#34;)]</span>
<span style=color:#a6e22e>    [return: WampResult(CollectionResultTreatment.Multivalued)]</span>
    Task&lt;<span style=color:#66d9ef>string</span>[]&gt; SplitNameAsync(<span style=color:#66d9ef>string</span> fullname);
}
</code></pre></div><p>Call example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>string</span>[] splitted = proxy.SplitNameAsync(<span style=color:#e6db74>&#34;Homer Simpson&#34;</span>);
</code></pre></div><blockquote><p>Note: The sample is based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/rpc/complex>this</a> AutobahnJS sample</p></blockquote><h2 id=call-customization>Call customization</h2><p>The GetCalleeProxy method of IWampRealmServiceProvider now has an overload that receives an &ldquo;interceptor&rdquo; instance. The &ldquo;interceptor&rdquo; allows customizing the call being performed.</p><p>For instance, assume you want to call procedures of a contract that its procedures uris are known only on runtime. This is possible implementing a ICalleeProxyInterceptor:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyCalleeProxyInterceptor</span> : CalleeProxyInterceptor
{
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> <span style=color:#66d9ef>int</span> mCalleeIndex;

    <span style=color:#66d9ef>public</span> MyCalleeProxyInterceptor(<span style=color:#66d9ef>int</span> calleeIndex) :
        <span style=color:#66d9ef>base</span>(<span style=color:#66d9ef>new</span> CallOptions())
    {
        mCalleeIndex = calleeIndex;
    }

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>string</span> GetProcedureUri(MethodInfo method)
    {
        <span style=color:#66d9ef>string</span> format = <span style=color:#66d9ef>base</span>.GetProcedureUri(method);
        <span style=color:#66d9ef>string</span> result = <span style=color:#66d9ef>string</span>.Format(format, mCalleeIndex);
        <span style=color:#66d9ef>return</span> result;
    }
}

</code></pre></div><p>This interceptor modifies the procedure uri of the procedure to call. For example, we can declare an interface with a method with this signature:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> ISquareService
{
<span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.square.{0}&#34;)]</span>
    Task&lt;<span style=color:#66d9ef>int</span>&gt; Square(<span style=color:#66d9ef>int</span> number);
}
</code></pre></div><p>And then specify the index in runtime:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> Task Main()
{
    DefaultWampChannelFactory factory = <span style=color:#66d9ef>new</span> DefaultWampChannelFactory();

    IWampChannel channel =
        factory.CreateJsonChannel(<span style=color:#e6db74>&#34;ws://localhost:8080/ws&#34;</span>, <span style=color:#e6db74>&#34;realm1&#34;</span>);

    <span style=color:#66d9ef>await</span> channel.Open().ConfigureAwait(<span style=color:#66d9ef>false</span>);

    <span style=color:#66d9ef>int</span> index = GetRuntimeIndex();

    ISquareService proxy =
        channel.RealmProxy.Services.GetCalleeProxy&lt;ISquareService&gt;
        (<span style=color:#66d9ef>new</span> CachedCalleeProxyInterceptor(
            <span style=color:#66d9ef>new</span> MyCalleeProxyInterceptor(index)));

    <span style=color:#66d9ef>int</span> nine = <span style=color:#66d9ef>await</span> proxy.Square(<span style=color:#ae81ff>3</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>); <span style=color:#75715e>// Calls (&#34;com.myapp.square.&#34; + index)
</span><span style=color:#75715e></span>}
</code></pre></div><blockquote><p>Note: we wrap our interceptor with the CachedCalleeProxyInterceptor in order to cache the results of our interceptor, in order to avoid calculating them each call.</p></blockquote><p>In addition, the interceptor allows to modify the options sent to each call. The following sections demonstrates modifications that can be used to leverage WAMP advanced profile features.</p><blockquote><p>Note: these interceptors are still &ldquo;static&rdquo;, i.e: they don&rsquo;t allow returning a value that depends on the call parameters.</p></blockquote><h3 id=caller-identification>Caller identification</h3><p>Callee proxy sample:</p><p>According to WAMP2 specification, a Caller can request to disclose its identification (by specifying disclose_me = true on call request).</p><p>Specifying this is possible when obtaining callee proxy.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> Task Main()
{
    DefaultWampChannelFactory factory = <span style=color:#66d9ef>new</span> DefaultWampChannelFactory();

    IWampChannel channel =
        factory.CreateJsonChannel(<span style=color:#e6db74>&#34;ws://localhost:8080/ws&#34;</span>, <span style=color:#e6db74>&#34;realm1&#34;</span>);

    <span style=color:#66d9ef>await</span> channel.Open().ConfigureAwait(<span style=color:#66d9ef>false</span>);

    <span style=color:#66d9ef>var</span> callOptions = <span style=color:#66d9ef>new</span> CallOptions()
    {
        DiscloseMe = <span style=color:#66d9ef>true</span>
    };

    ISquareService proxy =
        channel.RealmProxy.Services.GetCalleeProxy&lt;ISquareService&gt;
        (<span style=color:#66d9ef>new</span> CachedCalleeProxyInterceptor(<span style=color:#66d9ef>new</span> CalleeProxyInterceptor(callOptions)));

    <span style=color:#66d9ef>await</span> proxy.Square(-<span style=color:#ae81ff>2</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
    <span style=color:#66d9ef>await</span> proxy.Square(<span style=color:#ae81ff>0</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
    <span style=color:#66d9ef>await</span> proxy.Square(<span style=color:#ae81ff>2</span>).ConfigureAwait(<span style=color:#66d9ef>false</span>);
}
</code></pre></div><blockquote><p>Note: The sample is based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/rpc/options>this</a> AutobahnJS sample</p></blockquote></section></article></main></div><div class="col-sm-3 col-sm-offset-1 doc-sidebar"><div id=sidebar><div class=sidebar-module><div class=sidebar-toc><h4 class=sidebar-heading>Table of Contents</h4><ul><li><strong><a href=#title>Reflection-based Caller</a></strong></li></ul><nav id=TableOfContents><ul><li><a href=#basic-usage>Basic usage</a></li><li><a href=#supported-features>Supported features</a><ul><li><a href=#async-method-support>Async method support</a></li><li><a href=#tuples-support>Tuples support</a></li><li><a href=#exception-support>Exception support</a></li><li><a href=#progressive-call-results>Progressive call results</a></li><li><a href=#cancellation-support>Cancellation support</a></li><li><a href=#outref-parameters>out/ref parameters</a></li><li><a href=#multi-valued-results>Multi-valued results</a></li></ul></li><li><a href=#call-customization>Call customization</a><ul><li><a href=#caller-identification>Caller identification</a></li></ul></li></ul></nav></div></div><div class=sidebar-module><h4 class=sidebar-heading>Pages in Categories</h4><ul class=sidebar-category-list><li><a href=https://wampsharp.net/categories/authentication><span class=doc-list-category>Authentication</span></a><ul><li><a href=/wamp2/client/client-side-authentication/>Client-side authentication</a></li><li><a href=/wamp2/router/cookie-based-router-side-authentication/>Cookie based router-side authentication</a></li><li><a href=/wamp2/router/router-side-authentication/>Router-side authentication</a></li><li><a href=/wamp2/client/wamp-cra-client-side-authentication/>WAMP-CRA client side authentication</a></li><li><a href=/wamp2/router/wamp-cra-router-side-authentication/>WAMP-CRA router-side authentication</a></li></ul></li><li><a href=https://wampsharp.net/categories/callee><span class=doc-list-category>Callee</span></a><ul><li><a href=/wamp2/roles/callee/getting-started-with-callee/>Getting started with Callee</a></li><li><a href=/wamp2/roles/callee/raw-callee/>Raw Callee</a></li><li><a href=/wamp2/roles/callee/reflection-based-callee/>Reflection-based Callee</a></li></ul></li><li><a href=https://wampsharp.net/categories/caller><span class=doc-list-category>Caller</span></a><ul><li><a href=/wamp2/roles/caller/getting-started-with-caller/>Getting started with Caller</a></li><li><a href=/wamp2/roles/caller/raw-caller/>Raw Caller</a></li><li><span class=active>Reflection-based Caller</span></li></ul></li><li><a href=https://wampsharp.net/categories/client><span class=doc-list-category>Client</span></a><ul><li><a href=/wamp2/router/transports/rawsocket/>RawSocket transport</a></li><li><a href=/wamp2/client/client-side-authentication/>Client-side authentication</a></li><li><a href=/wamp2/meta-api-service/>Meta-api descriptor service</a></li><li><a href=/wamp2/testament-service/>Testament service</a></li><li><a href=/wamp2/client/wamp-cra-client-side-authentication/>WAMP-CRA client side authentication</a></li><li><a href=/wamp2/client/wampchannel/>WampChannel</a></li><li><a href=/wamp2/client/wampchannelreconnector/>WampChannelReconnector</a></li></ul></li><li><a href=https://wampsharp.net/categories/getting-started><span class=doc-list-category>Getting-Started</span></a><ul><li><a href=/wamp2/roles/callee/getting-started-with-callee/>Getting started with Callee</a></li><li><a href=/wamp2/roles/caller/getting-started-with-caller/>Getting started with Caller</a></li><li><a href=/wamp2/roles/publisher/getting-started-with-publisher/>Getting started with Publisher</a></li><li><a href=/wamp2/roles/subscriber/getting-started-with-subscriber/>Getting started with Subscriber</a></li><li><a href=/wamp2/getting-started-with-wampv2/>Getting started with WAMPv2</a></li></ul></li><li><a href=https://wampsharp.net/categories/publisher><span class=doc-list-category>Publisher</span></a><ul><li><a href=/wamp2/roles/publisher/getting-started-with-publisher/>Getting started with Publisher</a></li><li><a href=/wamp2/roles/publisher/raw-publisher/>Raw Publisher</a></li><li><a href=/wamp2/roles/publisher/reflection-based-publisher/>Reflection-based Publisher</a></li><li><a href=/wamp2/roles/publisher/rx-based-publisher/>Rx-based Publisher</a></li></ul></li><li><a href=https://wampsharp.net/categories/release-notes><span class=doc-list-category>Release-Notes</span></a><ul><li><a href=/release-notes/wampsharp-v20.1.1-release-notes/>WampSharp v20.1.1 release notes</a></li><li><a href=/release-notes/wampsharp-v18.6.1-release-notes/>WampSharp v18.6.1 release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.6.41-beta-release-notes/>WampSharp v1.2.6.41-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.5.21-beta-release-notes/>WampSharp v1.2.5.21-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.4.18-beta-release-notes/>WampSharp v1.2.4.18-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.3.12-beta-release-notes/>WampSharp v1.2.3.12-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.2.8-beta-release-notes/>WampSharp v1.2.2.8-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.1.6-beta-release-notes/>WampSharp v1.2.1.6-beta release notes</a></li></ul></li><li><a href=https://wampsharp.net/categories/roadmap><span class=doc-list-category>Roadmap</span></a><ul><li><a href=/roadmap/>Roadmap</a></li></ul></li><li><a href=https://wampsharp.net/categories/router><span class=doc-list-category>Router</span></a><ul><li><a href=/wamp2/router/transports/rawsocket/>RawSocket transport</a></li><li><a href=/wamp2/router/transports/websocket/>WebSocket transports</a></li><li><a href=/wamp2/router/cookie-based-router-side-authentication/>Cookie based router-side authentication</a></li><li><a href=/wamp2/meta-api-service/>Meta-api descriptor service</a></li><li><a href=/wamp2/router/router-side-authentication/>Router-side authentication</a></li><li><a href=/wamp2/testament-service/>Testament service</a></li><li><a href=/wamp2/router/wamp-cra-router-side-authentication/>WAMP-CRA router-side authentication</a></li><li><a href=/wamp2/router/wamphost/>WampHost</a></li></ul></li><li><a href=https://wampsharp.net/categories/subscriber><span class=doc-list-category>Subscriber</span></a><ul><li><a href=/wamp2/roles/subscriber/getting-started-with-subscriber/>Getting started with Subscriber</a></li><li><a href=/wamp2/roles/subscriber/raw-subscriber/>Raw Subscriber</a></li><li><a href=/wamp2/roles/subscriber/reflection-based-subscriber/>Reflection-based Subscriber</a></li><li><a href=/wamp2/roles/subscriber/rx-based-subscriber/>Rx-based Subscriber</a></li></ul></li><li><a href=https://wampsharp.net/categories/wamp1><span class=doc-list-category>Wamp1</span></a><ul><li><a href=/wamp1/getting-started-with-wampv1/>Getting started with WAMPv1</a></li><li><a href=/wamp1/getting-started-with-wampv1-client/>Getting started with WAMPv1 client</a></li><li><a href=/wamp1/notes-for-wampv1-users/>Notes for WAMP1 users</a></li><li><a href=/wamp1/server-pubsub-hosting-wampv1/>Server PubSub hosting (WAMPv1)</a></li><li><a href=/wamp1/server-rpc-hosting-wampv1/>Server RPC hosting (WAMPv1)</a></li></ul></li></ul></div><div class=sidebar-module><h4 class=sidebar-heading>Tags</h4><div class=tag-box><a class=tag-item href=https://wampsharp.net/tags/authentication>authentication</a>
<a class=tag-item href=https://wampsharp.net/tags/callee>callee</a>
<a class=tag-item href=https://wampsharp.net/tags/caller>caller</a>
<a class=tag-item href=https://wampsharp.net/tags/client>client</a>
<a class=tag-item href=https://wampsharp.net/tags/publisher>publisher</a>
<a class=tag-item href=https://wampsharp.net/tags/raw-api>raw-api</a>
<a class=tag-item href=https://wampsharp.net/tags/reflection>reflection</a>
<a class=tag-item href=https://wampsharp.net/tags/roadmap>roadmap</a>
<a class=tag-item href=https://wampsharp.net/tags/router>router</a>
<a class=tag-item href=https://wampsharp.net/tags/rx>rx</a>
<a class=tag-item href=https://wampsharp.net/tags/services>services</a>
<a class=tag-item href=https://wampsharp.net/tags/subscriber>subscriber</a>
<a class=tag-item href=https://wampsharp.net/tags/transports>transports</a>
<a class=tag-item href=https://wampsharp.net/tags/wamp1>wamp1</a>
<a class=tag-item href=https://wampsharp.net/tags/wampcra>wampcra</a></div></div></div></div></div><hr><div class=row><div class=col-sm-8><p class=doc-footer-em><a href=# onclick=resetSidebarPos()>Back to TOP</a></p></div></div></div><footer class=doc-footer><p class=doc-footer-em>Browse <strong><a href=https://github.com/Code-Sharp/WampSharp.net/>Repository</a></strong></p><p>Copyright (c) 2013-2020, Elad Zelingher; All rights reserved.</p><p>Powered by <strong><a href=https://github.com/progrhyme/hugo-theme-bootie-docs>Bootie Docs</a></strong> - theme for <a href=http://gohugo.io/>Hugo</a> by <a href=https://github.com/progrhyme/>progrhyme</a>.</p></footer><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-98663639-2','auto');ga('send','pageview');</script><script src=https://wampsharp.net/js/jquery.min.js></script><script src=https://wampsharp.net/js/bootstrap.min.js></script><script src=https://wampsharp.net/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script src=https://wampsharp.net/js/ie10-viewport-bug-workaround.js></script><script src=https://wampsharp.net/js/bootie-docs.js></script><script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><script>docsearch({apiKey:'0327efc17cad5f4c0585144de916a164',indexName:'wampsharp',inputSelector:'#as_q',debug:false,});</script></body></html>