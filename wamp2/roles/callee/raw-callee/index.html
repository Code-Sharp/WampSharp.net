<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="alternate" href="/index.xml" type="application/rss+xml" title="WampSharp">
		<link rel="icon" href="http://wampsharp.net/favicon.ico">
		<title>Raw Callee - WampSharp</title>
		
		<link rel="stylesheet" href="http://wampsharp.net/css/highlight/default.css">
		<link rel="stylesheet" href="http://wampsharp.net/css/bootstrap.min.css">
		<link rel="stylesheet" href="http://wampsharp.net/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="http://wampsharp.net/css/theme.css">
		<link rel="stylesheet" href="http://wampsharp.net/css/bootie-docs.css">
		<link rel="stylesheet" href="http://wampsharp.net/css/site.css">
	</head>

<body role="document">

	
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://wampsharp.net/">WampSharp</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li ><a href="http://wampsharp.net/">Home</a></li>
			
			
				
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Categories<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
						
							<li><a href="http://wampsharp.net/categories/authentication">Authentication</a></li>
						
							<li><a href="http://wampsharp.net/categories/callee">Callee</a></li>
						
							<li><a href="http://wampsharp.net/categories/caller">Caller</a></li>
						
							<li><a href="http://wampsharp.net/categories/client">Client</a></li>
						
							<li><a href="http://wampsharp.net/categories/getting-started">Getting-Started</a></li>
						
							<li><a href="http://wampsharp.net/categories/publisher">Publisher</a></li>
						
							<li><a href="http://wampsharp.net/categories/release-notes">Release-Notes</a></li>
						
							<li><a href="http://wampsharp.net/categories/roadmap">Roadmap</a></li>
						
							<li><a href="http://wampsharp.net/categories/router">Router</a></li>
						
							<li><a href="http://wampsharp.net/categories/subscriber">Subscriber</a></li>
						
							<li><a href="http://wampsharp.net/categories/wamp1">Wamp1</a></li>
						
						</ul>
					</li>
				
				</ul>
				
			</div>
		</div>
	</nav>

<div class="container">


<div class="row">
	<div class="col-sm-8 doc-main">
		<main role="main">
			<article>
				<a id="title"></a>
				<h1 class="doc-entry-title">Raw Callee</h1>
				<div class="doc-entry-meta">
					<span><time datetime="2017-07-30">July 30, 2017</time></span>
				</div>
				<section>
					

<p>WampSharp provides a lower level api that allows to deal with rpc operations as they are sent/received, which is called Raw callee.</p>

<p>Actually, the reflection based callee api is built above the Raw callee api.</p>

<p>In order to use the raw callee api, implement IWampRpcOperation. A IWampFormatter is passed to your methods in order to allow you to deserialize the method parameters. In order to return a result or an error, call the corresponding caller method.</p>

<p>After that, register it using Register method of RpcOperationCatalog property of IWampRealm/IWampRealmProxy interfaces.</p>

<h2 id="registration-samples">Registration samples</h2>

<h3 id="client-side">Client side</h3>

<pre><code class="language-csharp">internal class Program
{
    public static void Main(string[] args)
    {
        const string location = &quot;ws://127.0.0.1:8080/&quot;;

        DefaultWampChannelFactory channelFactory = new DefaultWampChannelFactory();

        IWampChannel channel = channelFactory.CreateJsonChannel(location, &quot;realm1&quot;);

        Task openTask = channel.Open();

        // await openTask;
        openTask.Wait();

        ArgLenOperation operation = new ArgLenOperation();

        IWampRealmProxy realm = channel.RealmProxy;

        RegisterOptions registerOptions = new RegisterOptions();

        Task&lt;IAsyncDisposable&gt; registrationTask = realm.RpcCatalog.Register(operation, registerOptions);
        // await registrationTask;
        registrationTask.Wait();

        Console.ReadLine();
    }
}
</code></pre>

<h3 id="router-side">Router side</h3>

<pre><code class="language-csharp">internal class Program
{
    public static void Main(string[] args)
    {
        const string location = &quot;ws://127.0.0.1:8080/&quot;;

        using (IWampHost host = new DefaultWampHost(location))
        {
            ArgLenOperation operation = new ArgLenOperation();

            IWampHostedRealm realm = host.RealmContainer.GetRealmByName(&quot;realm1&quot;);

            Task&lt;IAsyncDisposable&gt; registrationTask = realm.Services.RegisterCallee(operation);
            // await registrationTask;
            registrationTask.Wait();

            host.Open();

            Console.WriteLine(&quot;Server is running on &quot; + location);
            Console.ReadLine();
        }
    }
}
</code></pre>

<h2 id="iwamprpcoperation-implementation-sample">IWampRpcOperation implementation sample</h2>

<pre><code class="language-csharp">public class Add2Operation : IWampRpcOperation
{
    public string Procedure
    {
        get
        {
            return &quot;com.arguments.add2&quot;;
        }
    }

    public IWampCancellableInvocation Invoke&lt;TMessage&gt;(IWampRawRpcOperationRouterCallback caller, IWampFormatter&lt;TMessage&gt;
    {
        Dictionary&lt;string, object&gt; dummyDetails = new Dictionary&lt;string, object&gt;();

        caller.Error(WampObjectFormatter.Value, dummyDetails, &quot;wamp.error.runtime_error&quot;,
                     new object[] { &quot;Expected parameters&quot; });

        return null;
    }

    public IWampCancellableInvocation Invoke&lt;TMessage&gt;(IWampRawRpcOperationRouterCallback caller, IWampFormatter&lt;TMessage&gt;
                                 TMessage[] arguments)
    {
        return InnerInvoke(caller, formatter, arguments);
    }

    public IWampCancellableInvocation Invoke&lt;TMessage&gt;(IWampRawRpcOperationRouterCallback caller, IWampFormatter&lt;TMessage&gt;
                                 TMessage[] arguments, IDictionary&lt;string, TMessage&gt; argumentsKeywords)
    {
        return InnerInvoke(caller, formatter, arguments);
    }

    private static IWampCancellableInvocation InnerInvoke&lt;TMessage&gt;(IWampRawRpcOperationRouterCallback caller, IWampFormat
                                              TMessage[] arguments)
    {
        int x = formatter.Deserialize&lt;int&gt;(arguments[0]);
        int y = formatter.Deserialize&lt;int&gt;(arguments[1]);
        int result = x + y;

        YieldOptions dummyDetails = new YieldOptions();

        caller.Result(WampObjectFormatter.Value, dummyDetails, new object[] { result });
        return null;
    }
}
</code></pre>

<h2 id="synclocalrpcoperation-and-asynclocalrpcoperation">SyncLocalRpcOperation and AsyncLocalRpcOperation.</h2>

<p>WampSharp defines some base-classes that make it easier to implement IWampRpcOperation, named SyncLocalRpcOperation and AsyncLocalRpcOperation.</p>

<p>In these classes, we define the parameters we expect to receive and let WampSharp deserialize them for us.</p>

<h3 id="static-parameters-example">Static parameters example</h3>

<pre><code class="language-csharp">public class Add2Operation : SyncLocalRpcOperation
{
    private readonly RpcParameter[] mParameters = new RpcParameter[]
    {
        new RpcParameter(name: &quot;x&quot;, type: typeof (int), position: 0),
        new RpcParameter(name: &quot;y&quot;, type: typeof (int), position: 1)
    };

    public Add2Operation()
        : base(&quot;com.arguments.add2&quot;)
    {
    }

    public override RpcParameter[] Parameters
    {
        get
        {
            return mParameters;
        }
    }

    public override bool HasResult
    {
        get
        {
            return true;
        }
    }

    public override CollectionResultTreatment CollectionResultTreatment
    {
        get
        {
            return CollectionResultTreatment.SingleValue;
        }
    }

    protected override object InvokeSync&lt;TMessage&gt;(IWampRawRpcOperationRouterCallback caller,
                                                   IWampFormatter&lt;TMessage&gt; formatter,
                                                   InvocationDetails details,
                                                   TMessage[] arguments,
                                                   IDictionary&lt;string, TMessage&gt; argumentsKeywords,
                                                   out IDictionary&lt;string, object&gt; outputs)
    {
        object[] parameters =
            UnpackParameters(formatter, arguments, argumentsKeywords)
                .ToArray();

        int x = (int)parameters[0];
        int y = (int)parameters[1];

        outputs = null;

        return (x + y);
    }
}
</code></pre>

<p>This handles lookups for parameters named x and y (or positioned at 0, 1), and handles exception throw if not both present.
Note that you can return an array and return CollectionResultTreatment.Multivalued from CollectionResultTreatment if you want to return an array with more than one item as the Arguments of the YIELD/RESULT message.
Note that you can also set outputs to a dictionary with keywords arguments parameters that will be sent as ArgumensKws of the YIELD/RETURN message.</p>

<h3 id="dynamic-parameters-example">Dynamic parameters example</h3>

<pre><code class="language-csharp">public class ArgLenOperation : SyncLocalRpcOperation
{
    private readonly RpcParameter[] mParameters = new RpcParameter[0];

    public ArgLenOperation()
        : base(&quot;com.arguments.arglen&quot;)
    {
    }

    protected override object InvokeSync&lt;TMessage&gt;(IWampRawRpcOperationRouterCallback caller,
                                                   IWampFormatter&lt;TMessage&gt; formatter,
                                                   InvocationDetails details,
                                                   TMessage[] arguments,
                                                   IDictionary&lt;string, TMessage&gt; argumentsKeywords,
                                                   out IDictionary&lt;string, object&gt; outputs)
    {
        outputs = null;

        int argumentsLength = 0;

        if (arguments != null)
        {
            argumentsLength = arguments.Length;
        }

        int argumentKeyWordsLength = 0;

        if (argumentsKeywords != null)
        {
            argumentKeyWordsLength = argumentsKeywords.Count;
        }

        return new int[] { argumentsLength, argumentKeyWordsLength };
    }

    public override RpcParameter[] Parameters
    {
        get { return mParameters; }
    }

    public override bool HasResult
    {
        get { return true; }
    }

    public override CollectionResultTreatment CollectionResultTreatment
    {
        get { return CollectionResultTreatment.Multivalued; }
    }
}
</code></pre>

<blockquote>
<p>Note:  This sample is based on <a href="https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/rpc/arguments">this</a> AutobahnJS sample</p>
</blockquote>

				</section>
			</article>
		</main>
	</div> 

	

<div class="col-sm-3 col-sm-offset-1 doc-sidebar">
	<div id="sidebar">
	<div class="sidebar-module">
		<div class="sidebar-toc">
			<h4 class="sidebar-heading">Table of Contents</h4>
			<ul>
				<li><strong><a href="#title">Raw Callee</a></strong></li>
			</ul>
			<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#registration-samples">Registration samples</a>
<ul>
<li><a href="#client-side">Client side</a></li>
<li><a href="#router-side">Router side</a></li>
</ul></li>
<li><a href="#iwamprpcoperation-implementation-sample">IWampRpcOperation implementation sample</a></li>
<li><a href="#synclocalrpcoperation-and-asynclocalrpcoperation">SyncLocalRpcOperation and AsyncLocalRpcOperation.</a>
<ul>
<li><a href="#static-parameters-example">Static parameters example</a></li>
<li><a href="#dynamic-parameters-example">Dynamic parameters example</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
		</div>
	</div>
	<div class="sidebar-module">
		<h4 class="sidebar-heading">Pages in Categories</h4>
		<ul class="sidebar-category-list">
		
			<li>
				<a href="http://wampsharp.net/categories/authentication">
					<span class="doc-list-category">Authentication</span>
				</a>
				<ul>
					<li><a href="/wamp2/client/client-side-authentication/">Client-side authentication</a>
					</li>
				
					<li><a href="/wamp2/router/cookie-based-router-side-authentication/">Cookie based router-side authentication</a>
					</li>
				
					<li><a href="/wamp2/router/router-side-authentication/">Router-side authentication</a>
					</li>
				
					<li><a href="/wamp2/client/wamp-cra-client-side-authentication/">WAMP-CRA client side authentication</a>
					</li>
				
					<li><a href="/wamp2/router/wamp-cra-router-side-authentication/">WAMP-CRA router-side authentication</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/callee">
					<span class="doc-list-category">Callee</span>
				</a>
				<ul>
					<li><a href="/wamp2/roles/callee/getting-started-with-callee/">Getting started with Callee</a>
					</li>
				
					<li>
						<span class="active">Raw Callee</span>
						</li>
				
					<li><a href="/wamp2/roles/callee/reflection-based-callee/">Reflection-based Callee</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/caller">
					<span class="doc-list-category">Caller</span>
				</a>
				<ul>
					<li><a href="/wamp2/roles/caller/getting-started-with-caller/">Getting started with Caller</a>
					</li>
				
					<li><a href="/wamp2/roles/caller/raw-caller/">Raw Caller</a>
					</li>
				
					<li><a href="/wamp2/roles/caller/reflection-based-caller/">Reflection-based Caller</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/client">
					<span class="doc-list-category">Client</span>
				</a>
				<ul>
					<li><a href="/wamp2/router/transports/rawsocket/">RawSocket transport</a>
					</li>
				
					<li><a href="/wamp2/client/client-side-authentication/">Client-side authentication</a>
					</li>
				
					<li><a href="/wamp2/meta-api-service/">Meta-api descriptor service</a>
					</li>
				
					<li><a href="/wamp2/client/wamp-cra-client-side-authentication/">WAMP-CRA client side authentication</a>
					</li>
				
					<li><a href="/wamp2/client/wampchannel/">WampChannel</a>
					</li>
				
					<li><a href="/wamp2/client/wampchannelreconnector/">WampChannelReconnector</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/getting-started">
					<span class="doc-list-category">Getting-Started</span>
				</a>
				<ul>
					<li><a href="/wamp2/roles/callee/getting-started-with-callee/">Getting started with Callee</a>
					</li>
				
					<li><a href="/wamp2/roles/caller/getting-started-with-caller/">Getting started with Caller</a>
					</li>
				
					<li><a href="/wamp2/roles/publisher/getting-started-with-publisher/">Getting started with Publisher</a>
					</li>
				
					<li><a href="/wamp2/roles/subscriber/getting-started-with-subscriber/">Getting started with Subscriber</a>
					</li>
				
					<li><a href="/wamp2/getting-started-with-wampv2/">Getting started with WAMPv2</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/publisher">
					<span class="doc-list-category">Publisher</span>
				</a>
				<ul>
					<li><a href="/wamp2/roles/publisher/getting-started-with-publisher/">Getting started with Publisher</a>
					</li>
				
					<li><a href="/wamp2/roles/publisher/raw-publisher/">Raw Publisher</a>
					</li>
				
					<li><a href="/wamp2/roles/publisher/reflection-based-publisher/">Reflection-based Publisher</a>
					</li>
				
					<li><a href="/wamp2/roles/publisher/rx-based-publisher/">Rx-based Publisher</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/release-notes">
					<span class="doc-list-category">Release-Notes</span>
				</a>
				<ul>
					<li><a href="/release-notes/wampsharp-v1.2.6.41-beta-release-notes/">WampSharp v1.2.6.41-beta release notes</a>
					</li>
				
					<li><a href="/release-notes/wampsharp-v1.2.5.21-beta-release-notes/">WampSharp v1.2.5.21-beta release notes</a>
					</li>
				
					<li><a href="/release-notes/wampsharp-v1.2.4.18-beta-release-notes/">WampSharp v1.2.4.18-beta release notes</a>
					</li>
				
					<li><a href="/release-notes/wampsharp-v1.2.3.12-beta-release-notes/">WampSharp v1.2.3.12-beta release notes</a>
					</li>
				
					<li><a href="/release-notes/wampsharp-v1.2.2.8-beta-release-notes/">WampSharp v1.2.2.8-beta release notes</a>
					</li>
				
					<li><a href="/release-notes/wampsharp-v1.2.1.6-beta-release-notes/">WampSharp v1.2.1.6-beta release notes</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/roadmap">
					<span class="doc-list-category">Roadmap</span>
				</a>
				<ul>
					<li><a href="/roadmap/">Roadmap</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/router">
					<span class="doc-list-category">Router</span>
				</a>
				<ul>
					<li><a href="/wamp2/router/transports/rawsocket/">RawSocket transport</a>
					</li>
				
					<li><a href="/wamp2/router/transports/websocket/">WebSocket transports</a>
					</li>
				
					<li><a href="/wamp2/router/cookie-based-router-side-authentication/">Cookie based router-side authentication</a>
					</li>
				
					<li><a href="/wamp2/meta-api-service/">Meta-api descriptor service</a>
					</li>
				
					<li><a href="/wamp2/router/router-side-authentication/">Router-side authentication</a>
					</li>
				
					<li><a href="/wamp2/router/wamp-cra-router-side-authentication/">WAMP-CRA router-side authentication</a>
					</li>
				
					<li><a href="/wamp2/router/wamphost/">WampHost</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/subscriber">
					<span class="doc-list-category">Subscriber</span>
				</a>
				<ul>
					<li><a href="/wamp2/roles/subscriber/getting-started-with-subscriber/">Getting started with Subscriber</a>
					</li>
				
					<li><a href="/wamp2/roles/subscriber/raw-subscriber/">Raw Subscriber</a>
					</li>
				
					<li><a href="/wamp2/roles/subscriber/reflection-based-subscriber/">Reflection-based Subscriber</a>
					</li>
				
					<li><a href="/wamp2/roles/subscriber/rx-based-subscriber/">Rx-based Subscriber</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/wamp1">
					<span class="doc-list-category">Wamp1</span>
				</a>
				<ul>
					<li><a href="/wamp1/getting-started-with-wampv1/">Getting started with WAMPv1</a>
					</li>
				
					<li><a href="/wamp1/getting-started-with-wampv1-client/">Getting started with WAMPv1 client</a>
					</li>
				
					<li><a href="/wamp1/notes-for-wampv1-users/">Notes for WAMP1 users</a>
					</li>
				
					<li><a href="/wamp1/server-pubsub-hosting-wampv1/">Server PubSub hosting (WAMPv1)</a>
					</li>
				
					<li><a href="/wamp1/server-rpc-hosting-wampv1/">Server RPC hosting (WAMPv1)</a>
					</li>
				
				</ul>
			</li>
		
		</ul>
	</div>
	<div class="sidebar-module">
		<h4 class="sidebar-heading">Tags</h4>
		<div class="tag-box">
		
			<a class="tag-item" href="http://wampsharp.net/tags/authentication">authentication</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/callee">callee</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/caller">caller</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/client">client</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/publisher">publisher</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/raw-api">raw-api</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/reflection">reflection</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/roadmap">roadmap</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/router">router</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/rx">rx</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/services">services</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/subscriber">subscriber</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/transports">transports</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/wamp1">wamp1</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/wampcra">wampcra</a>
		
		</div>
	</div>
	</div>
</div>

</div> 


<hr />

<div class="row">
	<div class="col-sm-8">
		<p class="doc-footer-em"><a href="#" onclick="resetSidebarPos()">Back to TOP</a></p>
	</div>
</div>

</div> 

<footer class="doc-footer">
	
	<p>Copyright (c) 2013-2017, Elad Zelingher; All rights reserved.</p>
	<p>Powered by <strong><a href="https://github.com/progrhyme/hugo-theme-bootie-docs">Bootie Docs</a></strong> - theme for <a href="http://gohugo.io/">Hugo</a> by <a href="https://github.com/progrhyme/">progrhyme</a>.</p>
</footer>



<script src="http://wampsharp.net/js/jquery.min.js"></script>
<script src="http://wampsharp.net/js/bootstrap.min.js"></script>

<script src="http://wampsharp.net/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="http://wampsharp.net/js/ie10-viewport-bug-workaround.js"></script>
<script src="http://wampsharp.net/js/bootie-docs.js"></script>

</body>
</html>
