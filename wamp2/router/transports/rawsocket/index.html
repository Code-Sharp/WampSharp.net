<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate href=/index.xml type=application/rss+xml title=WampSharp><link rel=icon href=https://wampsharp.net/favicon.ico><title>RawSocket transport - WampSharp</title><link rel=stylesheet href=https://wampsharp.net/css/highlight/github.css><link rel=stylesheet href=https://wampsharp.net/css/bootstrap.min.css><link rel=stylesheet href=https://wampsharp.net/css/bootstrap-theme.min.css><link rel=stylesheet href=https://wampsharp.net/css/theme.css><link rel=stylesheet href=https://wampsharp.net/css/bootie-docs.css><link rel=stylesheet href=https://wampsharp.net/css/site.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@v2.6.3/dist/cdn/docsearch.min.css></head><body role=document><nav class="navbar navbar-inverse navbar-fixed-top"><div class=container><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#navbar aria-expanded=false aria-controls=navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://wampsharp.net/>WampSharp</a></div><div id=navbar class="navbar-collapse collapse"><ul class="nav navbar-nav"><li><a href=https://wampsharp.net/>Home</a></li><li class=dropdown><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-expanded=false>Categories<span class=caret></span></a><ul class=dropdown-menu role=menu><li><a href=https://wampsharp.net/categories/authentication>Authentication</a></li><li><a href=https://wampsharp.net/categories/callee>Callee</a></li><li><a href=https://wampsharp.net/categories/caller>Caller</a></li><li><a href=https://wampsharp.net/categories/client>Client</a></li><li><a href=https://wampsharp.net/categories/getting-started>Getting-Started</a></li><li><a href=https://wampsharp.net/categories/publisher>Publisher</a></li><li><a href=https://wampsharp.net/categories/release-notes>Release-Notes</a></li><li><a href=https://wampsharp.net/categories/roadmap>Roadmap</a></li><li><a href=https://wampsharp.net/categories/router>Router</a></li><li><a href=https://wampsharp.net/categories/subscriber>Subscriber</a></li><li><a href=https://wampsharp.net/categories/wamp1>Wamp1</a></li></ul></li></ul><form class="navbar-form navbar-left" role=search><div class="input-group doc-search-form"><input type=text id=as_q class="search-query doc-search-input-text" placeholder="Search Site"></div></form></div></div></nav><div class=container><div class=row><div class="col-sm-8 doc-main"><main role=main><article><a id=title></a><h1 class=doc-entry-title>RawSocket transport</h1><div class=doc-entry-meta><span><time datetime=2017-08-01>August 01, 2017</time></span></div><section><p>WampSharp supports the <a href=https://github.com/wamp-proto/wamp-proto/blob/master/rfc/text/advanced/ap_transport_rawsocket.md>RawSocket transport</a>.
It is available through the <a href=https://www.nuget.org/packages/WampSharp.RawSocket>WampSharp.RawSocket</a> NuGet package.</p><h3 id=router-side-usage>Router-side usage</h3><h3 id=tcplistener-implementation>TcpListener implementation</h3><p>This is a standalone implementation which uses <a href=https://docs.microsoft.com/en-us/dotnet/api/system.net.sockets.tcplistener><code>TcpListener</code></a>. In order to use it, install the <a href=https://www.nuget.org/packages/WampSharp.RawSocket>WampSharp.RawSocket</a> NuGet package. Usage example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>IWampHost host = <span style=color:#66d9ef>new</span> WampHost();

RawSocketTransport transport =
    <span style=color:#66d9ef>new</span> RawSocketTransport(TcpListener.Create(<span style=color:#ae81ff>8080</span>));

host.RegisterTransport(transport,
                       <span style=color:#66d9ef>new</span> JTokenJsonBinding());

</code></pre></div><h3 id=aspnet-core-implementation>ASP.NET Core implementation</h3><p>This is an implementation of the RawSocket protocol using <a href=https://www.nuget.org/packages/Microsoft.AspNetCore.Connections.Abstractions/>Microsoft.AspNetCore.Connections.Abstractions</a> package, which is part of <a href=https://github.com/aspnet/KestrelHttpServer/issues/1980>Project Bedrock</a>. This implementation is present in the package <a href=http://nuget.org/packages/WampSharp.AspNetCore.RawSocket>WampSharp.AspNetCore.RawSocket</a>.</p><p>Usage sample:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>using</span> System.Net;
<span style=color:#66d9ef>using</span> Microsoft.AspNetCore;
<span style=color:#66d9ef>using</span> Microsoft.AspNetCore.Hosting;
<span style=color:#66d9ef>using</span> WampSharp.AspNetCore.RawSocket;
<span style=color:#66d9ef>using</span> WampSharp.Binding;
<span style=color:#66d9ef>using</span> WampSharp.V2;

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Program</span>
{
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Main(<span style=color:#66d9ef>string</span>[] args)
    {
        WampHost wampHost = <span style=color:#66d9ef>new</span> WampHost();

        JTokenJsonBinding jsonBinding = <span style=color:#66d9ef>new</span> JTokenJsonBinding();

        IWebHost host =
            WebHost.CreateDefaultBuilder(args)
                   .UseKestrel(options =&gt;
                               {
                                   options.Listen(IPAddress.Loopback, <span style=color:#ae81ff>8080</span>,
                                                  builder =&gt;
                                                  {
                                                      <span style=color:#75715e>// Configure RawSocket transport
</span><span style=color:#75715e></span>                                                      wampHost
                                                          .RegisterTransport(<span style=color:#66d9ef>new</span> AspNetCoreRawSocketTransport(builder),
                                                                             jsonBinding);
                                                  });
                               })
                   .Configure(app =&gt;
                              {
                                  wampHost.Open();
                              })
                   .Build();

        host.Run();
    }
}
</code></pre></div><p>This allows you to listen to both RawSocket and WebSocket requests on the same port. For example, the following code listens both to WAMP RawSocket requests on port 8080 and to WAMP WebSocket requests on <code>ws://localhost:8080/ws/</code> (using the <a href=http://nuget.org/packages/WampSharp.AspNetCore.WebSockets.Server>WampSharp.AspNetCore.WebSockets.Server</a> package):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>using</span> System.Net;
<span style=color:#66d9ef>using</span> Microsoft.AspNetCore;
<span style=color:#66d9ef>using</span> Microsoft.AspNetCore.Builder;
<span style=color:#66d9ef>using</span> Microsoft.AspNetCore.Hosting;
<span style=color:#66d9ef>using</span> WampSharp.AspNetCore.RawSocket;
<span style=color:#66d9ef>using</span> WampSharp.AspNetCore.WebSockets.Server;
<span style=color:#66d9ef>using</span> WampSharp.Binding;
<span style=color:#66d9ef>using</span> WampSharp.V2;

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Program</span>
{
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Main(<span style=color:#66d9ef>string</span>[] args)
    {
        WampHost wampHost = <span style=color:#66d9ef>new</span> WampHost();

        JTokenJsonBinding jsonBinding = <span style=color:#66d9ef>new</span> JTokenJsonBinding();

        IWebHost host =
            WebHost.CreateDefaultBuilder(args)
                   .UseKestrel(options =&gt;
                               {
                                   options.Listen(IPAddress.Loopback, <span style=color:#ae81ff>8080</span>,
                                                  builder =&gt;
                                                  {
                                                      <span style=color:#75715e>// Log all of the http bytes as they are sent and received
</span><span style=color:#75715e></span>                                                      builder.UseConnectionLogging();

                                                      <span style=color:#75715e>// Configure RawSocket transport
</span><span style=color:#75715e></span>                                                      wampHost
                                                          .RegisterTransport(<span style=color:#66d9ef>new</span> AspNetCoreRawSocketTransport(builder),
                                                                             jsonBinding);
                                                  });
                               })
                   .Configure(app =&gt;
                              {
                                  app.Map(<span style=color:#e6db74>&#34;/ws&#34;</span>,
                                          builder =&gt;
                                          {
                                              builder.UseWebSockets();

                                              <span style=color:#75715e>// Configure WebSockets transport
</span><span style=color:#75715e></span>                                              wampHost.RegisterTransport
                                                  (<span style=color:#66d9ef>new</span> AspNetCoreWebSocketTransport(builder),
                                                   jsonBinding);
                                          });

                                  wampHost.Open();
                              })
                   .Build();

        host.Run();
    }
}
</code></pre></div><h3 id=client-side-usage>Client-side usage</h3><p>In order to obtain a RawSocket IWampChannel, you can use the fluent syntax api:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>IWampChannelFactory factory = <span style=color:#66d9ef>new</span> WampChannelFactory();

IWampChannel channel =
    factory.ConnectToRealm(<span style=color:#e6db74>&#34;realm1&#34;</span>)
           .RawSocketTransport(<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>, <span style=color:#ae81ff>8080</span>)
           .MsgpackSerialization()
           .Build();

</code></pre></div><p>This fluent-api allows some RawSocket customization features:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>IWampChannelFactory factory = <span style=color:#66d9ef>new</span> WampChannelFactory();

IWampChannel channel =
    factory.ConnectToRealm(<span style=color:#e6db74>&#34;realm1&#34;</span>)
           .RawSocketTransport(<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>, <span style=color:#ae81ff>8080</span>)
           .ConnectFrom(<span style=color:#66d9ef>new</span> IPEndPoint(IPAddress.Loopback, <span style=color:#ae81ff>1345</span>))
           <span style=color:#75715e>// Chooses the port to connect from
</span><span style=color:#75715e></span>           .AutoPing(TimeSpan.FromSeconds(<span style=color:#ae81ff>45</span>))
           <span style=color:#75715e>// Enables auto-ping
</span><span style=color:#75715e></span>           .MsgpackSerialization()
           .Build();
</code></pre></div><blockquote><p>Note: currently <a href=https://crossbar.io>crossbar</a> and Autobahn variants <a href=https://github.com/crossbario/crossbar/issues/381>don&rsquo;t implement RawSocket&rsquo;s ping/pongs</a>. Therefore, auto-ping is disabled by default. You can enable it manually, both for router-side transport (by passing to the RawSocketTransport constructor an non-null auto-ping interval) and for client-side transport (as in the sample).</p></blockquote></section></article></main></div><div class="col-sm-3 col-sm-offset-1 doc-sidebar"><div id=sidebar><div class=sidebar-module><div class=sidebar-toc><h4 class=sidebar-heading>Table of Contents</h4><ul><li><strong><a href=#title>RawSocket transport</a></strong></li></ul><nav id=TableOfContents><ul><li><ul><li><a href=#router-side-usage>Router-side usage</a></li><li><a href=#tcplistener-implementation>TcpListener implementation</a></li><li><a href=#aspnet-core-implementation>ASP.NET Core implementation</a></li><li><a href=#client-side-usage>Client-side usage</a></li></ul></li></ul></nav></div></div><div class=sidebar-module><h4 class=sidebar-heading>Pages in Categories</h4><ul class=sidebar-category-list><li><a href=https://wampsharp.net/categories/authentication><span class=doc-list-category>Authentication</span></a><ul><li><a href=/wamp2/client/client-side-authentication/>Client-side authentication</a></li><li><a href=/wamp2/router/cookie-based-router-side-authentication/>Cookie based router-side authentication</a></li><li><a href=/wamp2/router/router-side-authentication/>Router-side authentication</a></li><li><a href=/wamp2/client/wamp-cra-client-side-authentication/>WAMP-CRA client side authentication</a></li><li><a href=/wamp2/router/wamp-cra-router-side-authentication/>WAMP-CRA router-side authentication</a></li></ul></li><li><a href=https://wampsharp.net/categories/callee><span class=doc-list-category>Callee</span></a><ul><li><a href=/wamp2/roles/callee/getting-started-with-callee/>Getting started with Callee</a></li><li><a href=/wamp2/roles/callee/raw-callee/>Raw Callee</a></li><li><a href=/wamp2/roles/callee/reflection-based-callee/>Reflection-based Callee</a></li></ul></li><li><a href=https://wampsharp.net/categories/caller><span class=doc-list-category>Caller</span></a><ul><li><a href=/wamp2/roles/caller/getting-started-with-caller/>Getting started with Caller</a></li><li><a href=/wamp2/roles/caller/raw-caller/>Raw Caller</a></li><li><a href=/wamp2/roles/caller/reflection-based-caller/>Reflection-based Caller</a></li></ul></li><li><a href=https://wampsharp.net/categories/client><span class=doc-list-category>Client</span></a><ul><li><span class=active>RawSocket transport</span></li><li><a href=/wamp2/client/client-side-authentication/>Client-side authentication</a></li><li><a href=/wamp2/meta-api-service/>Meta-api descriptor service</a></li><li><a href=/wamp2/testament-service/>Testament service</a></li><li><a href=/wamp2/client/wamp-cra-client-side-authentication/>WAMP-CRA client side authentication</a></li><li><a href=/wamp2/client/wampchannel/>WampChannel</a></li><li><a href=/wamp2/client/wampchannelreconnector/>WampChannelReconnector</a></li></ul></li><li><a href=https://wampsharp.net/categories/getting-started><span class=doc-list-category>Getting-Started</span></a><ul><li><a href=/wamp2/roles/callee/getting-started-with-callee/>Getting started with Callee</a></li><li><a href=/wamp2/roles/caller/getting-started-with-caller/>Getting started with Caller</a></li><li><a href=/wamp2/roles/publisher/getting-started-with-publisher/>Getting started with Publisher</a></li><li><a href=/wamp2/roles/subscriber/getting-started-with-subscriber/>Getting started with Subscriber</a></li><li><a href=/wamp2/getting-started-with-wampv2/>Getting started with WAMPv2</a></li></ul></li><li><a href=https://wampsharp.net/categories/publisher><span class=doc-list-category>Publisher</span></a><ul><li><a href=/wamp2/roles/publisher/getting-started-with-publisher/>Getting started with Publisher</a></li><li><a href=/wamp2/roles/publisher/raw-publisher/>Raw Publisher</a></li><li><a href=/wamp2/roles/publisher/reflection-based-publisher/>Reflection-based Publisher</a></li><li><a href=/wamp2/roles/publisher/rx-based-publisher/>Rx-based Publisher</a></li></ul></li><li><a href=https://wampsharp.net/categories/release-notes><span class=doc-list-category>Release-Notes</span></a><ul><li><a href=/release-notes/wampsharp-v20.1.1-release-notes/>WampSharp v20.1.1 release notes</a></li><li><a href=/release-notes/wampsharp-v18.6.1-release-notes/>WampSharp v18.6.1 release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.6.41-beta-release-notes/>WampSharp v1.2.6.41-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.5.21-beta-release-notes/>WampSharp v1.2.5.21-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.4.18-beta-release-notes/>WampSharp v1.2.4.18-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.3.12-beta-release-notes/>WampSharp v1.2.3.12-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.2.8-beta-release-notes/>WampSharp v1.2.2.8-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.1.6-beta-release-notes/>WampSharp v1.2.1.6-beta release notes</a></li></ul></li><li><a href=https://wampsharp.net/categories/roadmap><span class=doc-list-category>Roadmap</span></a><ul><li><a href=/roadmap/>Roadmap</a></li></ul></li><li><a href=https://wampsharp.net/categories/router><span class=doc-list-category>Router</span></a><ul><li><span class=active>RawSocket transport</span></li><li><a href=/wamp2/router/transports/websocket/>WebSocket transports</a></li><li><a href=/wamp2/router/cookie-based-router-side-authentication/>Cookie based router-side authentication</a></li><li><a href=/wamp2/meta-api-service/>Meta-api descriptor service</a></li><li><a href=/wamp2/router/router-side-authentication/>Router-side authentication</a></li><li><a href=/wamp2/testament-service/>Testament service</a></li><li><a href=/wamp2/router/wamp-cra-router-side-authentication/>WAMP-CRA router-side authentication</a></li><li><a href=/wamp2/router/wamphost/>WampHost</a></li></ul></li><li><a href=https://wampsharp.net/categories/subscriber><span class=doc-list-category>Subscriber</span></a><ul><li><a href=/wamp2/roles/subscriber/getting-started-with-subscriber/>Getting started with Subscriber</a></li><li><a href=/wamp2/roles/subscriber/raw-subscriber/>Raw Subscriber</a></li><li><a href=/wamp2/roles/subscriber/reflection-based-subscriber/>Reflection-based Subscriber</a></li><li><a href=/wamp2/roles/subscriber/rx-based-subscriber/>Rx-based Subscriber</a></li></ul></li><li><a href=https://wampsharp.net/categories/wamp1><span class=doc-list-category>Wamp1</span></a><ul><li><a href=/wamp1/getting-started-with-wampv1/>Getting started with WAMPv1</a></li><li><a href=/wamp1/getting-started-with-wampv1-client/>Getting started with WAMPv1 client</a></li><li><a href=/wamp1/notes-for-wampv1-users/>Notes for WAMP1 users</a></li><li><a href=/wamp1/server-pubsub-hosting-wampv1/>Server PubSub hosting (WAMPv1)</a></li><li><a href=/wamp1/server-rpc-hosting-wampv1/>Server RPC hosting (WAMPv1)</a></li></ul></li></ul></div><div class=sidebar-module><h4 class=sidebar-heading>Tags</h4><div class=tag-box><a class=tag-item href=https://wampsharp.net/tags/authentication>authentication</a>
<a class=tag-item href=https://wampsharp.net/tags/callee>callee</a>
<a class=tag-item href=https://wampsharp.net/tags/caller>caller</a>
<a class=tag-item href=https://wampsharp.net/tags/client>client</a>
<a class=tag-item href=https://wampsharp.net/tags/publisher>publisher</a>
<a class=tag-item href=https://wampsharp.net/tags/raw-api>raw-api</a>
<a class=tag-item href=https://wampsharp.net/tags/reflection>reflection</a>
<a class=tag-item href=https://wampsharp.net/tags/roadmap>roadmap</a>
<a class=tag-item href=https://wampsharp.net/tags/router>router</a>
<a class=tag-item href=https://wampsharp.net/tags/rx>rx</a>
<a class=tag-item href=https://wampsharp.net/tags/services>services</a>
<a class=tag-item href=https://wampsharp.net/tags/subscriber>subscriber</a>
<a class=tag-item href=https://wampsharp.net/tags/transports>transports</a>
<a class=tag-item href=https://wampsharp.net/tags/wamp1>wamp1</a>
<a class=tag-item href=https://wampsharp.net/tags/wampcra>wampcra</a></div></div></div></div></div><hr><div class=row><div class=col-sm-8><p class=doc-footer-em><a href=# onclick=resetSidebarPos()>Back to TOP</a></p></div></div></div><footer class=doc-footer><p class=doc-footer-em>Browse <strong><a href=https://github.com/Code-Sharp/WampSharp.net/>Repository</a></strong></p><p>Copyright (c) 2013-2020, Elad Zelingher; All rights reserved.</p><p>Powered by <strong><a href=https://github.com/progrhyme/hugo-theme-bootie-docs>Bootie Docs</a></strong> - theme for <a href=http://gohugo.io/>Hugo</a> by <a href=https://github.com/progrhyme/>progrhyme</a>.</p></footer><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-98663639-2','auto');ga('send','pageview');</script><script src=https://wampsharp.net/js/jquery.min.js></script><script src=https://wampsharp.net/js/bootstrap.min.js></script><script src=https://wampsharp.net/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script src=https://wampsharp.net/js/ie10-viewport-bug-workaround.js></script><script src=https://wampsharp.net/js/bootie-docs.js></script><script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><script>docsearch({apiKey:'0327efc17cad5f4c0585144de916a164',indexName:'wampsharp',inputSelector:'#as_q',debug:false,});</script></body></html>