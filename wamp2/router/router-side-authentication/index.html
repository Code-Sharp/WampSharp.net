<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="alternate" href="/index.xml" type="application/rss+xml" title="WampSharp">
		<link rel="icon" href="http://wampsharp.net/favicon.ico">
		<title>Router-side authentication - WampSharp</title>
		
		<link rel="stylesheet" href="http://wampsharp.net/css/highlight/default.css">
		<link rel="stylesheet" href="http://wampsharp.net/css/bootstrap.min.css">
		<link rel="stylesheet" href="http://wampsharp.net/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="http://wampsharp.net/css/theme.css">
		<link rel="stylesheet" href="http://wampsharp.net/css/bootie-docs.css">
		<link rel="stylesheet" href="http://wampsharp.net/css/site.css">
	</head>

<body role="document">

	
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://wampsharp.net/">WampSharp</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li ><a href="http://wampsharp.net/">Home</a></li>
			
			
				
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Categories<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
						
							<li><a href="http://wampsharp.net/categories/authentication">Authentication</a></li>
						
							<li><a href="http://wampsharp.net/categories/callee">Callee</a></li>
						
							<li><a href="http://wampsharp.net/categories/caller">Caller</a></li>
						
							<li><a href="http://wampsharp.net/categories/client">Client</a></li>
						
							<li><a href="http://wampsharp.net/categories/getting-started">Getting-Started</a></li>
						
							<li><a href="http://wampsharp.net/categories/publisher">Publisher</a></li>
						
							<li><a href="http://wampsharp.net/categories/release-notes">Release-Notes</a></li>
						
							<li><a href="http://wampsharp.net/categories/roadmap">Roadmap</a></li>
						
							<li><a href="http://wampsharp.net/categories/router">Router</a></li>
						
							<li><a href="http://wampsharp.net/categories/subscriber">Subscriber</a></li>
						
							<li><a href="http://wampsharp.net/categories/wamp1">Wamp1</a></li>
						
						</ul>
					</li>
				
				</ul>
				
			</div>
		</div>
	</nav>

<div class="container">


<div class="row">
	<div class="col-sm-8 doc-main">
		<main role="main">
			<article>
				<a id="title"></a>
				<h1 class="doc-entry-title">Router-side authentication</h1>
				<div class="doc-entry-meta">
					<span><time datetime="2017-07-30">July 30, 2017</time></span>
				</div>
				<section>
					

<p>This page describes router-side authentication.</p>

<p>In order to use router-side authentication, you&rsquo;ll need to create an instance of a (Default)WampAuthenticationHost and initialize it with a IWampSessionAuthenticatorFactory - that is an interface which will create a IWampSessionAuthenticator - a mechanism which is responsible of the authentication process of an individual client.</p>

<h2 id="iwampsessionauthenticator">IWampSessionAuthenticator</h2>

<p>IWampSessionAuthenticator is an interface which represents a mechanism which is responsible of the authentication process of an individual client. Whenever a client requests to join the router (i.e. sends a HELLO message), an IWampSessionAuthenticator is created by the IWampSessionAuthenticatorFactory passed to the WampHost.</p>

<p>This instance handles the client&rsquo;s authentication process: after the IWampSessionAuthenticator is created, the router checks if the client is authenticated (by checking the IsAuthenticated property). If the client isn&rsquo;t authenticated, a CHALLENGE message is sent to the client, with authmethod and extra parameters which are specified by the IWampSessionAuthenticator instance&rsquo;s AuthenticationMethod and ChallengeDetails properties. When a client sends an AUTHENTICATE message, the IWampSessionAuthenticator&rsquo;s Authenticate method is called with the received signature and extra parameters. At this point, the IWampSessionAuthenticator&rsquo;s IsAuthenticated property should be set to true if the client is authenticated.</p>

<p>In any point of this process, a WampAuthenticationException can be thrown. If such an exception is thrown, an ABORT message will be sent to the client with exception specified parameters.</p>

<p>Once the client is authenticated, a WELCOME message will be sent to the client with details and authid, authmethod parameters as specified in WelcomeDetails, AuthenticationId and AuthenticationMethod properties. After that, the Authorizer property of the IWampSessionAuthenticator&rsquo;s instance will be used determine if the client is allowed to perform certain operations. See IWampAuthorizer section for more info.</p>

<h2 id="wampsessionauthenticator">WampSessionAuthenticator</h2>

<p>In order to make it easier to implement the IWampSessionAuthenticator interface, the abstract class WampSessionAuthenticator is provided. In this class, the only members which are needed to be implemented are Authenticate, AuthenticationId and AuthenticationMethod. Other properties are implemented as auto-properties, which you can set their values. All members are virtual, so you can also override them.</p>

<p>In addition, a WampSessionAuthenticator&lt;TExtra&gt; class is provided, which is the same as WampSessionAuthenticator, but deserializes the given extra dictionary passed in AUTHENTICATE message to the given TExtra type.</p>

<h2 id="iwampauthorizer">IWampAuthorizer</h2>

<p>IWampAuthorizer is an interface which checks whether an individual client is allowed to perform certain WAMP operations.</p>

<pre><code class="language-csharp">public interface IWampAuthorizer
{
    bool CanRegister(RegisterOptions options, string procedure);
    bool CanCall(CallOptions options, string procedure);
    bool CanPublish(PublishOptions options, string topicUri);
    bool CanSubscribe(SubscribeOptions options, string topicUri);
}

</code></pre>

<p>Each method can return a false value in order to prevent access of the client to do certain actions. In addition, a WampException can be thrown by any method, which will result in sending an ERROR message to the client with the exception details (except in Publish case, where this will happen only if the client requested acknowledge).</p>

<h2 id="ticket-based-authentication-example">Ticket-based authentication example</h2>

<p>This is an example implementation of a very simplified version of <a href="https://github.com/wamp-proto/wamp-proto/blob/master/rfc/text/advanced/ap_authentication_ticket.md">Ticket-based authentication</a>. It shows off a bit C# 6.0 features too.</p>

<pre><code class="language-csharp">public class MyAuthenticatorFactory : IWampSessionAuthenticatorFactory
{
    private readonly IDictionary&lt;string, string&gt; mUserToTicket =
        new Dictionary&lt;string, string&gt;
        {
            [&quot;peter&quot;] = &quot;magic_secret_1&quot;,
            [&quot;joe&quot;] = &quot;magic_secret_2&quot;
        };

    private readonly IDictionary&lt;string, IWampAuthorizer&gt; mUserToAuthorizer =
        new Dictionary&lt;string, IWampAuthorizer&gt;
        {
            [&quot;peter&quot;] = new FrontendStaticAuthorizer(),
            [&quot;joe&quot;] = new FrontendStaticAuthorizer()
        };

    public IWampSessionAuthenticator GetSessionAuthenticator
        (WampPendingClientDetails details,
         IWampSessionAuthenticator transportAuthenticator)
    {
        HelloDetails helloDetails = details.HelloDetails;

        if (helloDetails.AuthenticationMethods?.Contains(&quot;ticket&quot;) != true)
        {
            throw new WampAuthenticationException(&quot;supports only 'ticket' authentication&quot;);
        }

        string user = helloDetails.AuthenticationId;

        string ticket;

        if (user == null ||
            !mUserToTicket.TryGetValue(user, out ticket))
        {
            throw new WampAuthenticationException
                ($&quot;no user with authid '{user}' in user database&quot;);
        }

        return new TicketSessionAuthenticator(user, ticket, mUserToAuthorizer[user]);
    }
}

public class TicketSessionAuthenticator : WampSessionAuthenticator
{
    private readonly string mTicket;
    private readonly IWampAuthorizer mAuthorizer;

    public TicketSessionAuthenticator(string authenticationId, string ticket, IWampAuthorizer authorizer)
    {
        AuthenticationId = authenticationId;
        mTicket = ticket;
        mAuthorizer = authorizer;
    }

    public override void Authenticate(string signature, AuthenticateExtraData extra)
    {
        if (signature == mTicket)
        {
            IsAuthenticated = true;
            Authorizer = mAuthorizer;

            WelcomeDetails = new WelcomeDetails()
            {
                AuthenticationProvider = &quot;hardcoded&quot;,
                AuthenticationRole = &quot;frontend&quot;
            };
        }
    }

    public override string AuthenticationId { get; }

    public override string AuthenticationMethod =&gt; &quot;ticket&quot;;
}

public class BackendStaticAuthorizer : IWampAuthorizer
{
    public bool CanRegister(RegisterOptions options, string procedure) =&gt; true;

    public bool CanCall(CallOptions options, string procedure) =&gt; true;

    public bool CanPublish(PublishOptions options, string topicUri) =&gt; true;

    public bool CanSubscribe(SubscribeOptions options, string topicUri)
    {
        return topicUri != &quot;com.example.topic2&quot;;
    }
}

public class FrontendStaticAuthorizer : IWampAuthorizer
{
    public bool CanRegister(RegisterOptions options, string procedure) =&gt; false;

    public bool CanCall(CallOptions options, string procedure) =&gt; procedure == &quot;com.example.add2&quot;;

    public bool CanPublish(PublishOptions options, string topicUri)
    {
        return (topicUri.StartsWith(&quot;com.example.&quot;) &amp;&amp; topicUri != &quot;com.example.topic2&quot;) ||
               topicUri == &quot;com.foobar.topic1&quot;;
    }

    public bool CanSubscribe(SubscribeOptions options, string topicUri) =&gt; false;
}
</code></pre>

<p>After that we create a WampAuthenticationHost and pass to it an instance of our MyAuthenticatorFactory:</p>

<pre><code class="language-csharp">public class Program
{
    private static void Main(string[] args)
    {
        DefaultWampAuthenticationHost host =
            new DefaultWampAuthenticationHost(&quot;ws://127.0.0.1:8080/ws&quot;,
                                              new MyAuthenticatorFactory());


        IWampHostedRealm realm =
            host.RealmContainer.GetRealmByName(&quot;realm1&quot;);

        string[] topics = new[]
        {
            &quot;com.example.topic1&quot;,
            &quot;com.foobar.topic1&quot;,
            &quot;com.foobar.topic2&quot;
        };

        foreach (string topic in topics)
        {
            string currentTopic = topic;

            realm.Services.GetSubject&lt;string&gt;(topic).Subscribe
                (x =&gt; Console.WriteLine(&quot;event received on {0}: {1}&quot;, currentTopic, x));
        }

        realm.Services.RegisterCallee(new Add2Service()).Wait();

        host.Open();

        Console.ReadLine();
    }

    public class Add2Service : IAdd2Service
    {
        public int Add2(int x, int y)
        {
            return (x + y);
        }
    }

    public interface IAdd2Service
    {
        [WampProcedure(&quot;com.example.add2&quot;)]
        int Add2(int a, int b);
    }
}
</code></pre>

<h2 id="iwampsessionauthenticatorfactory">IWampSessionAuthenticatorFactory</h2>

<p>You might been asking yourself what is the transportAuthenticator parameter in IWampSessionAuthenticatorFactory&rsquo;s GetSessionAuthenticator method. Glad you&rsquo;ve asked! This is an authenticator that can be provided by the transport of the session. Some transports have built-in metadata that can be used in order to authenticate a client. The common example is <a href="http://wampsharp.net/wamp2/router/cookie-based-router-side-authentication/">cookies</a>.</p>

				</section>
			</article>
		</main>
	</div> 

	

<div class="col-sm-3 col-sm-offset-1 doc-sidebar">
	<div id="sidebar">
	<div class="sidebar-module">
		<div class="sidebar-toc">
			<h4 class="sidebar-heading">Table of Contents</h4>
			<ul>
				<li><strong><a href="#title">Router-side authentication</a></strong></li>
			</ul>
			<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#iwampsessionauthenticator">IWampSessionAuthenticator</a></li>
<li><a href="#wampsessionauthenticator">WampSessionAuthenticator</a></li>
<li><a href="#iwampauthorizer">IWampAuthorizer</a></li>
<li><a href="#ticket-based-authentication-example">Ticket-based authentication example</a></li>
<li><a href="#iwampsessionauthenticatorfactory">IWampSessionAuthenticatorFactory</a></li>
</ul></li>
</ul>
</nav>
		</div>
	</div>
	<div class="sidebar-module">
		<h4 class="sidebar-heading">Pages in Categories</h4>
		<ul class="sidebar-category-list">
		
			<li>
				<a href="http://wampsharp.net/categories/authentication">
					<span class="doc-list-category">Authentication</span>
				</a>
				<ul>
					<li><a href="/wamp2/client/client-side-authentication/">Client-side authentication</a>
					</li>
				
					<li><a href="/wamp2/router/cookie-based-router-side-authentication/">Cookie based router-side authentication</a>
					</li>
				
					<li>
						<span class="active">Router-side authentication</span>
						</li>
				
					<li><a href="/wamp2/client/wamp-cra-client-side-authentication/">WAMP-CRA client side authentication</a>
					</li>
				
					<li><a href="/wamp2/router/wamp-cra-router-side-authentication/">WAMP-CRA router-side authentication</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/callee">
					<span class="doc-list-category">Callee</span>
				</a>
				<ul>
					<li><a href="/wamp2/roles/callee/getting-started-with-callee/">Getting started with Callee</a>
					</li>
				
					<li><a href="/wamp2/roles/callee/raw-callee/">Raw Callee</a>
					</li>
				
					<li><a href="/wamp2/roles/callee/reflection-based-callee/">Reflection-based Callee</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/caller">
					<span class="doc-list-category">Caller</span>
				</a>
				<ul>
					<li><a href="/wamp2/roles/caller/getting-started-with-caller/">Getting started with Caller</a>
					</li>
				
					<li><a href="/wamp2/roles/caller/raw-caller/">Raw Caller</a>
					</li>
				
					<li><a href="/wamp2/roles/caller/reflection-based-caller/">Reflection-based Caller</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/client">
					<span class="doc-list-category">Client</span>
				</a>
				<ul>
					<li><a href="/wamp2/router/transports/rawsocket/">RawSocket transport</a>
					</li>
				
					<li><a href="/wamp2/client/client-side-authentication/">Client-side authentication</a>
					</li>
				
					<li><a href="/wamp2/meta-api-service/">Meta-api descriptor service</a>
					</li>
				
					<li><a href="/wamp2/client/wamp-cra-client-side-authentication/">WAMP-CRA client side authentication</a>
					</li>
				
					<li><a href="/wamp2/client/wampchannel/">WampChannel</a>
					</li>
				
					<li><a href="/wamp2/client/wampchannelreconnector/">WampChannelReconnector</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/getting-started">
					<span class="doc-list-category">Getting-Started</span>
				</a>
				<ul>
					<li><a href="/wamp2/roles/callee/getting-started-with-callee/">Getting started with Callee</a>
					</li>
				
					<li><a href="/wamp2/roles/caller/getting-started-with-caller/">Getting started with Caller</a>
					</li>
				
					<li><a href="/wamp2/roles/publisher/getting-started-with-publisher/">Getting started with Publisher</a>
					</li>
				
					<li><a href="/wamp2/roles/subscriber/getting-started-with-subscriber/">Getting started with Subscriber</a>
					</li>
				
					<li><a href="/wamp2/getting-started-with-wampv2/">Getting started with WAMPv2</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/publisher">
					<span class="doc-list-category">Publisher</span>
				</a>
				<ul>
					<li><a href="/wamp2/roles/publisher/getting-started-with-publisher/">Getting started with Publisher</a>
					</li>
				
					<li><a href="/wamp2/roles/publisher/raw-publisher/">Raw Publisher</a>
					</li>
				
					<li><a href="/wamp2/roles/publisher/reflection-based-publisher/">Reflection-based Publisher</a>
					</li>
				
					<li><a href="/wamp2/roles/publisher/rx-based-publisher/">Rx-based Publisher</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/release-notes">
					<span class="doc-list-category">Release-Notes</span>
				</a>
				<ul>
					<li><a href="/release-notes/wampsharp-v1.2.6.41-beta-release-notes/">WampSharp v1.2.6.41-beta release notes</a>
					</li>
				
					<li><a href="/release-notes/wampsharp-v1.2.5.21-beta-release-notes/">WampSharp v1.2.5.21-beta release notes</a>
					</li>
				
					<li><a href="/release-notes/wampsharp-v1.2.4.18-beta-release-notes/">WampSharp v1.2.4.18-beta release notes</a>
					</li>
				
					<li><a href="/release-notes/wampsharp-v1.2.3.12-beta-release-notes/">WampSharp v1.2.3.12-beta release notes</a>
					</li>
				
					<li><a href="/release-notes/wampsharp-v1.2.2.8-beta-release-notes/">WampSharp v1.2.2.8-beta release notes</a>
					</li>
				
					<li><a href="/release-notes/wampsharp-v1.2.1.6-beta-release-notes/">WampSharp v1.2.1.6-beta release notes</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/roadmap">
					<span class="doc-list-category">Roadmap</span>
				</a>
				<ul>
					<li><a href="/roadmap/">Roadmap</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/router">
					<span class="doc-list-category">Router</span>
				</a>
				<ul>
					<li><a href="/wamp2/router/transports/rawsocket/">RawSocket transport</a>
					</li>
				
					<li><a href="/wamp2/router/transports/websocket/">WebSocket transports</a>
					</li>
				
					<li><a href="/wamp2/router/cookie-based-router-side-authentication/">Cookie based router-side authentication</a>
					</li>
				
					<li><a href="/wamp2/meta-api-service/">Meta-api descriptor service</a>
					</li>
				
					<li>
						<span class="active">Router-side authentication</span>
						</li>
				
					<li><a href="/wamp2/router/wamp-cra-router-side-authentication/">WAMP-CRA router-side authentication</a>
					</li>
				
					<li><a href="/wamp2/router/wamphost/">WampHost</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/subscriber">
					<span class="doc-list-category">Subscriber</span>
				</a>
				<ul>
					<li><a href="/wamp2/roles/subscriber/getting-started-with-subscriber/">Getting started with Subscriber</a>
					</li>
				
					<li><a href="/wamp2/roles/subscriber/raw-subscriber/">Raw Subscriber</a>
					</li>
				
					<li><a href="/wamp2/roles/subscriber/reflection-based-subscriber/">Reflection-based Subscriber</a>
					</li>
				
					<li><a href="/wamp2/roles/subscriber/rx-based-subscriber/">Rx-based Subscriber</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="http://wampsharp.net/categories/wamp1">
					<span class="doc-list-category">Wamp1</span>
				</a>
				<ul>
					<li><a href="/wamp1/getting-started-with-wampv1/">Getting started with WAMPv1</a>
					</li>
				
					<li><a href="/wamp1/getting-started-with-wampv1-client/">Getting started with WAMPv1 client</a>
					</li>
				
					<li><a href="/wamp1/notes-for-wampv1-users/">Notes for WAMP1 users</a>
					</li>
				
					<li><a href="/wamp1/server-pubsub-hosting-wampv1/">Server PubSub hosting (WAMPv1)</a>
					</li>
				
					<li><a href="/wamp1/server-rpc-hosting-wampv1/">Server RPC hosting (WAMPv1)</a>
					</li>
				
				</ul>
			</li>
		
		</ul>
	</div>
	<div class="sidebar-module">
		<h4 class="sidebar-heading">Tags</h4>
		<div class="tag-box">
		
			<a class="tag-item" href="http://wampsharp.net/tags/authentication">authentication</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/callee">callee</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/caller">caller</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/client">client</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/publisher">publisher</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/raw-api">raw-api</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/reflection">reflection</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/roadmap">roadmap</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/router">router</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/rx">rx</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/services">services</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/subscriber">subscriber</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/transports">transports</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/wamp1">wamp1</a>
		
			<a class="tag-item" href="http://wampsharp.net/tags/wampcra">wampcra</a>
		
		</div>
	</div>
	</div>
</div>

</div> 


<hr />

<div class="row">
	<div class="col-sm-8">
		<p class="doc-footer-em"><a href="#" onclick="resetSidebarPos()">Back to TOP</a></p>
	</div>
</div>

</div> 

<footer class="doc-footer">
	
	<p>Copyright (c) 2013-2017, Elad Zelingher; All rights reserved.</p>
	<p>Powered by <strong><a href="https://github.com/progrhyme/hugo-theme-bootie-docs">Bootie Docs</a></strong> - theme for <a href="http://gohugo.io/">Hugo</a> by <a href="https://github.com/progrhyme/">progrhyme</a>.</p>
</footer>



<script src="http://wampsharp.net/js/jquery.min.js"></script>
<script src="http://wampsharp.net/js/bootstrap.min.js"></script>

<script src="http://wampsharp.net/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="http://wampsharp.net/js/ie10-viewport-bug-workaround.js"></script>
<script src="http://wampsharp.net/js/bootie-docs.js"></script>

</body>
</html>
