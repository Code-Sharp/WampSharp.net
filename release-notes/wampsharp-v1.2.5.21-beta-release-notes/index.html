<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate href=/index.xml type=application/rss+xml title=WampSharp><link rel=icon href=https://wampsharp.net/favicon.ico><title>WampSharp v1.2.5.21-beta release notes - WampSharp</title><link rel=stylesheet href=https://wampsharp.net/css/highlight/github.css><link rel=stylesheet href=https://wampsharp.net/css/bootstrap.min.css><link rel=stylesheet href=https://wampsharp.net/css/bootstrap-theme.min.css><link rel=stylesheet href=https://wampsharp.net/css/theme.css><link rel=stylesheet href=https://wampsharp.net/css/bootie-docs.css><link rel=stylesheet href=https://wampsharp.net/css/site.css></head><body role=document><nav class="navbar navbar-inverse navbar-fixed-top"><div class=container><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#navbar aria-expanded=false aria-controls=navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://wampsharp.net/>WampSharp</a></div><div id=navbar class="navbar-collapse collapse"><ul class="nav navbar-nav"><li><a href=https://wampsharp.net/>Home</a></li><li class=dropdown><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-expanded=false>Categories<span class=caret></span></a><ul class=dropdown-menu role=menu><li><a href=https://wampsharp.net/categories/authentication>Authentication</a></li><li><a href=https://wampsharp.net/categories/callee>Callee</a></li><li><a href=https://wampsharp.net/categories/caller>Caller</a></li><li><a href=https://wampsharp.net/categories/client>Client</a></li><li><a href=https://wampsharp.net/categories/getting-started>Getting-Started</a></li><li><a href=https://wampsharp.net/categories/publisher>Publisher</a></li><li><a href=https://wampsharp.net/categories/release-notes>Release-Notes</a></li><li><a href=https://wampsharp.net/categories/roadmap>Roadmap</a></li><li><a href=https://wampsharp.net/categories/router>Router</a></li><li><a href=https://wampsharp.net/categories/subscriber>Subscriber</a></li><li><a href=https://wampsharp.net/categories/wamp1>Wamp1</a></li></ul></li></ul></div></div></nav><div class=container><div class=row><div class="col-sm-8 doc-main"><main role=main><article><a id=title></a><h1 class=doc-entry-title>WampSharp v1.2.5.21-beta release notes</h1><div class=doc-entry-meta><span><time datetime=2016-08-29>August 29, 2016</time></span></div><section><h2 id=c-70-tuples-support>C# 7.0 tuples support</h2><p>This verion mainly focuses on <a href=https://blogs.msdn.microsoft.com/dotnet/2016/08/24/whats-new-in-csharp-7-0/>C# 7.0 tuples</a> support.</p><blockquote><p>Note: C# 7.0 tuples syntax is currently supported only by <a href=https://www.visualstudio.com/en-us/news/releasenotes/vs15-relnotes>Visual Studio &ldquo;15&rdquo; Preview 4</a>. You can download it <a href=https://www.visualstudio.com/en-us/downloads/visual-studio-next-downloads-vs.aspx>here</a>.</p></blockquote><h3 id=reflection-based-callee-tuples-support>Reflection-based callee tuples support</h3><p>From this version, you can return a C# 7.0 tuple from a reflection-based callee method. The tuple will be serialized to either the arguments keywords or to the arguments array of the YIELD message, depending on whether the returned tuple has named elements or positional elements. (tuples having elements which are partially named are not supported)</p><p>For example: A reflection-based callee that returns a tuple:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> IComplexResultService
{
<span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.add_complex&#34;)]</span>
    (<span style=color:#66d9ef>int</span> c, <span style=color:#66d9ef>int</span> ci) AddComplex(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> ai, <span style=color:#66d9ef>int</span> b, <span style=color:#66d9ef>int</span> bi);
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.split_name&#34;)]</span>
    (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>) SplitName(<span style=color:#66d9ef>string</span> fullname);
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ComplexResultService</span> : IComplexResultService
{
    <span style=color:#66d9ef>public</span> (<span style=color:#66d9ef>int</span> c, <span style=color:#66d9ef>int</span> ci) AddComplex(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> ai, <span style=color:#66d9ef>int</span> b, <span style=color:#66d9ef>int</span> bi)
    {
       <span style=color:#66d9ef>return</span> (a + b, ai + bi);
    }

    <span style=color:#66d9ef>public</span> (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>) SplitName(<span style=color:#66d9ef>string</span> fullname)
    {
        <span style=color:#66d9ef>string</span>[] splitted = fullname.Split(<span style=color:#e6db74>&#39; &#39;</span>);

        <span style=color:#66d9ef>string</span> forename = splitted[<span style=color:#ae81ff>0</span>];
        <span style=color:#66d9ef>string</span> surname = splitted[<span style=color:#ae81ff>1</span>];

        <span style=color:#66d9ef>return</span> (forename, surname);
    }
}
</code></pre></div><blockquote><p>Note: as usual, you can put the WampProcedureAttributes on the methods themselves instead of implementing an interface, i.e:</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#a6e22e>[WampProcedure(&#34;com.myapp.add_complex&#34;)]</span>
<span style=color:#66d9ef>public</span> (<span style=color:#66d9ef>int</span> c, <span style=color:#66d9ef>int</span> ci) AddComplex(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> ai, <span style=color:#66d9ef>int</span> b, <span style=color:#66d9ef>int</span> bi)
{
   <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>}
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>[WampProcedure(&#34;com.myapp.split_name&#34;)]</span>
<span style=color:#66d9ef>public</span> (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>) SplitName(<span style=color:#66d9ef>string</span> fullname)
{
   <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>}
</code></pre></div><p>Which can be consumed from <a href=https://github.com/crossbario/autobahn-js>AutobahnJS</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>call</span>(<span style=color:#e6db74>&#39;com.myapp.add_complex&#39;</span>, [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>]).<span style=color:#a6e22e>then</span>(
    <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>res</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Result: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>kwargs</span>.<span style=color:#a6e22e>c</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; + &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>kwargs</span>.<span style=color:#a6e22e>ci</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;i&#34;</span>);
    }
);

<span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>call</span>(<span style=color:#e6db74>&#39;com.myapp.split_name&#39;</span>, [<span style=color:#e6db74>&#39;Homer Simpson&#39;</span>]).<span style=color:#a6e22e>then</span>(
    <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>res</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Forename: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, Surname: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>1</span>]);
    }
;)
</code></pre></div><blockquote><p>Note: The samples are based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/rpc/complex>this</a> AutobahnJS/AutobahnPython sample</p></blockquote><h3 id=reflection-based-caller-tuples-support>Reflection-based caller tuples support</h3><p>Reflection-based callers also support C# 7.0 tuple return values from this version. You can simply declare a method returning a C# 7.0 tuple in your callee proxy interface.</p><p>For example, declare the following callee proxy interface:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> IComplexResultServiceProxy
{
<span style=color:#a6e22e>	[WampProcedure(&#34;com.myapp.add_complex&#34;)]</span>
	Task&lt;(<span style=color:#66d9ef>int</span> c, <span style=color:#66d9ef>int</span> ci)&gt; AddComplexAsync(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> ai, <span style=color:#66d9ef>int</span> b, <span style=color:#66d9ef>int</span> bi);
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>	[WampProcedure(&#34;com.myapp.split_name&#34;)]</span>
    Task&lt;(<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>)&gt; SplitNameAsync(<span style=color:#66d9ef>string</span> fullname);
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.add_complex&#34;)]</span>
    (<span style=color:#66d9ef>int</span> c, <span style=color:#66d9ef>int</span> ci) AddComplex(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> ai, <span style=color:#66d9ef>int</span> b, <span style=color:#66d9ef>int</span> bi);
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [WampProcedure(&#34;com.myapp.split_name&#34;)]</span>
    (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>) SplitName(<span style=color:#66d9ef>string</span> fullname);
}
</code></pre></div><p>And then obtain a callee proxy and simply call its methods:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task Run()
{
    DefaultWampChannelFactory factory = <span style=color:#66d9ef>new</span> DefaultWampChannelFactory();

    IWampChannel channel =
        factory.CreateJsonChannel(<span style=color:#e6db74>&#34;ws://localhost:8080/ws&#34;</span>, <span style=color:#e6db74>&#34;realm1&#34;</span>);

    <span style=color:#66d9ef>await</span> channel.Open();

    IComplexResultServiceProxy proxy =
        channel.RealmProxy.Services.GetCalleeProxy&lt;IComplexResultServiceProxy&gt;();

    (<span style=color:#66d9ef>string</span> forename, <span style=color:#66d9ef>string</span> surname) = <span style=color:#66d9ef>await</span> proxy.SplitNameAsync(<span style=color:#e6db74>&#34;Homer Simpson&#34;</span>);
    <span style=color:#75715e>// Synchronous version: 
</span><span style=color:#75715e></span>    <span style=color:#75715e>// (string forename, string surname) = proxy.SplitName(&#34;Homer Simpson&#34;);
</span><span style=color:#75715e></span>
    Console.WriteLine(<span style=color:#e6db74>$&#34;Forename: {forename}, Surname: {surname}&#34;</span>);

    (<span style=color:#66d9ef>int</span> c, <span style=color:#66d9ef>int</span> ci) = <span style=color:#66d9ef>await</span> proxy.AddComplexAsync(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>);
    <span style=color:#75715e>// Synchronous version: 
</span><span style=color:#75715e></span>    <span style=color:#75715e>// (int c, int ci) = proxy.AddComplex(2, 3, 4, 5);
</span><span style=color:#75715e></span>
    Console.WriteLine(<span style=color:#e6db74>$&#34;Result: {c} + {ci}i&#34;</span>);
}
</code></pre></div><p>This code can consume the following code written in Javascript:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>add_complex</span>(<span style=color:#a6e22e>args</span>, <span style=color:#a6e22e>kwargs</span>) {
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>autobahn</span>.<span style=color:#a6e22e>Result</span>([], {<span style=color:#a6e22e>c</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>ci</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>3</span>]});
}

<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>split_name</span>(<span style=color:#a6e22e>args</span>) {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>splitted</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34; &#34;</span>);
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>forename</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>splitted</span>[<span style=color:#ae81ff>0</span>];
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>surname</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>splitted</span>[<span style=color:#ae81ff>1</span>];
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>autobahn</span>.<span style=color:#a6e22e>Result</span>([<span style=color:#a6e22e>forename</span>, <span style=color:#a6e22e>surname</span>]);
}

<span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>register</span>(<span style=color:#e6db74>&#39;com.myapp.add_complex&#39;</span>, <span style=color:#a6e22e>add_complex</span>).<span style=color:#a6e22e>then</span>(
    <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>registration</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Procedure registered:&#34;</span>, <span style=color:#a6e22e>registration</span>.<span style=color:#a6e22e>id</span>);
    },
    <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Registration failed:&#34;</span>, <span style=color:#a6e22e>error</span>);
    }
);

<span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>register</span>(<span style=color:#e6db74>&#39;com.myapp.split_name&#39;</span>, <span style=color:#a6e22e>split_name</span>).<span style=color:#a6e22e>then</span>(
    <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>registration</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Procedure registered:&#34;</span>, <span style=color:#a6e22e>registration</span>.<span style=color:#a6e22e>id</span>);
    },
    <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Registration failed:&#34;</span>, <span style=color:#a6e22e>error</span>);
    }
);
</code></pre></div><blockquote><p>Note: The samples are based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/rpc/complex>this</a> AutobahnJS/AutobahnPython sample</p></blockquote><h3 id=rx-based-publishsubscribe-tuples-support>Rx-based publish/subscribe tuples support</h3><p>This version also introduces Rx-based publish/subscribe C# 7.0 tuple support. This allows to handle topics that have complex arguments in a strongly typed manner using ISubject&lt;> api.</p><p>In order to use this feature, a mechanism called IWampEventValueTupleConverter is introduced.</p><p>This interface is responsible for converting a IWampSerializedEvent instance to a specified tuple and a specified tuple instance to a IWampEvent.</p><p>Luckily enough, in order to implement this interface it is sufficient to derive from WampEventValueTupleConverter&lt;> and specify the desired tuple type. Nothing else is needed to be done.</p><p>(This might seem a bit odd, but that&rsquo;s the best way I&rsquo;m aware of for preserving ValueTuple element names after compilation)</p><p>Then, just pass an instance of your IWampEventValueTupleConverter to the new overload of IWampRealmServiceProvider&rsquo;s GetSubject method, which receives the topic&rsquo;s uri and an instance of IWampEventValueTupleConverter, in order to receive a ISubject&lt;> instance of your desired tuple type.</p><h4 id=rx-based-subscriber-tuples-support-sample>Rx-based subscriber tuples support sample</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task Run()
{
	DefaultWampChannelFactory factory = <span style=color:#66d9ef>new</span> DefaultWampChannelFactory();

	IWampChannel channel =
		factory.CreateJsonChannel(<span style=color:#e6db74>&#34;ws://localhost:8080/ws&#34;</span>, <span style=color:#e6db74>&#34;realm1&#34;</span>);

	<span style=color:#66d9ef>await</span> channel.Open();

	ISubject&lt;(<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>)&gt; topic1Subject =
		channel.RealmProxy.Services.GetSubject
				(<span style=color:#e6db74>&#34;com.myapp.topic1&#34;</span>,
				<span style=color:#66d9ef>new</span> MyPositionalTupleEventConverter());

	topic1Subject.Subscribe(<span style=color:#66d9ef>value</span> =&gt;
	{
		(<span style=color:#66d9ef>int</span> number1, <span style=color:#66d9ef>int</span> number2) = <span style=color:#66d9ef>value</span>;
		Console.WriteLine(<span style=color:#e6db74>$&#34;&gt;com.myapp.topic1: Got event: number1:{number1}, number2:{number2}&#34;</span>);
	});

	ISubject&lt;(<span style=color:#66d9ef>int</span> number1, <span style=color:#66d9ef>int</span> number2, <span style=color:#66d9ef>string</span> c, MyClass d)&gt; topic2Subject =
		channel.RealmProxy.Services.GetSubject
				(<span style=color:#e6db74>&#34;com.myapp.topic2&#34;</span>,
				<span style=color:#66d9ef>new</span> MyKeywordTupleEventConverter());

	topic2Subject.Subscribe(<span style=color:#66d9ef>value</span> =&gt;
	{
		(<span style=color:#66d9ef>int</span> number1, <span style=color:#66d9ef>int</span> number2, <span style=color:#66d9ef>string</span> c, MyClass d) = <span style=color:#66d9ef>value</span>;
		Console.WriteLine(<span style=color:#e6db74>$&#34;&gt;com.myapp.topic2: Got event: number1:{number1}, number2:{number2}, c:{c}, d:{d}&#34;</span>);
	});
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyPositionalTupleEventConverter</span> : WampEventValueTupleConverter&lt;(<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>)&gt;
{
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyKeywordTupleEventConverter</span> : WampEventValueTupleConverter&lt;(<span style=color:#66d9ef>int</span> number1, <span style=color:#66d9ef>int</span> number2, <span style=color:#66d9ef>string</span> c, MyClass d)&gt;
{
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyClass</span>
{
<span style=color:#a6e22e>    [JsonProperty(&#34;counter&#34;)]</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> Counter { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [JsonProperty(&#34;foo&#34;)]</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span>[] Foo { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>string</span> ToString()
    {
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>string</span>.Format(<span style=color:#e6db74>&#34;counter: {0}, foo: [{1}]&#34;</span>,
            Counter,
            <span style=color:#66d9ef>string</span>.Join(<span style=color:#e6db74>&#34;, &#34;</span>, Foo));
    }
}
</code></pre></div><p>This code can consume events published by the following Javascript code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>counter</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;

<span style=color:#a6e22e>setInterval</span>(<span style=color:#66d9ef>function</span> () {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>obj</span> <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;counter&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>counter</span>, <span style=color:#e6db74>&#39;foo&#39;</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>]};

    <span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>publish</span>(<span style=color:#e6db74>&#39;com.myapp.topic1&#39;</span>, [<span style=color:#a6e22e>randint</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>), <span style=color:#ae81ff>23</span>], {});
    <span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>publish</span>(<span style=color:#e6db74>&#39;com.myapp.topic2&#39;</span>, [], {<span style=color:#a6e22e>number1</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>randint</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>), <span style=color:#a6e22e>number2</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>23</span>, <span style=color:#a6e22e>c</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Hello&#34;</span>, <span style=color:#a6e22e>d</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>obj</span>});

    <span style=color:#a6e22e>counter</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;

    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;events published&#34;</span>);
}, <span style=color:#ae81ff>1000</span>);
</code></pre></div><blockquote><p>This example is based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/pubsub/complex>this</a> AutobahnJS sample.</p></blockquote><h4 id=rx-based-publisher-tuples-support-sample>Rx-based publisher tuples support sample</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task Run()
{
	DefaultWampChannelFactory factory = <span style=color:#66d9ef>new</span> DefaultWampChannelFactory();

	IWampChannel channel =
		factory.CreateJsonChannel(<span style=color:#e6db74>&#34;ws://localhost:8080/ws&#34;</span>, <span style=color:#e6db74>&#34;realm1&#34;</span>);

	<span style=color:#66d9ef>await</span> channel.Open();

	ISubject&lt;(<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>)&gt; topic1Subject =
		channel.RealmProxy.Services.GetSubject
				(<span style=color:#e6db74>&#34;com.myapp.topic1&#34;</span>,
				<span style=color:#66d9ef>new</span> MyPositionalTupleEventConverter());

	ISubject&lt;(<span style=color:#66d9ef>int</span> number1, <span style=color:#66d9ef>int</span> number2, <span style=color:#66d9ef>string</span> c, MyClass d)&gt; topic2Subject 
		channel.RealmProxy.Services.GetSubject
				(<span style=color:#e6db74>&#34;com.myapp.topic2&#34;</span>,
				<span style=color:#66d9ef>new</span> MyKeywordTupleEventConverter());

	IObservable&lt;<span style=color:#66d9ef>int</span>&gt; timer =
		Observable.Timer(TimeSpan.FromMilliseconds(<span style=color:#ae81ff>0</span>),
						 TimeSpan.FromMilliseconds(<span style=color:#ae81ff>1000</span>))
						 .Select((x, i) =&gt; i);

	Random random = <span style=color:#66d9ef>new</span> Random();

	IDisposable disposable =
		timer.Subscribe(<span style=color:#66d9ef>value</span> =&gt;
		{
			topic1Subject.OnNext((random.Next(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>), <span style=color:#ae81ff>23</span>));
			topic2Subject.OnNext((random.Next(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>), <span style=color:#ae81ff>23</span>, <span style=color:#e6db74>&#34;Hello&#34;</span>,
								  <span style=color:#66d9ef>new</span> MyClass()
								  {
									  Counter = <span style=color:#66d9ef>value</span>,
									  Foo = <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span>[] { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span> }
								  }));
		});
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyPositionalTupleEventConverter</span> : WampEventValueTupleConverter&lt;(<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>)&gt;
{
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyKeywordTupleEventConverter</span> : WampEventValueTupleConverter&lt;(<span style=color:#66d9ef>int</span> number1, <span style=color:#66d9ef>int</span> number2, <span style=color:#66d9ef>string</span> c, MyClass d)&gt;
{
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyClass</span>
{
<span style=color:#a6e22e>    [JsonProperty(&#34;counter&#34;)]</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> Counter { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [JsonProperty(&#34;foo&#34;)]</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span>[] Foo { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>string</span> ToString()
    {
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>string</span>.Format(<span style=color:#e6db74>&#34;counter: {0}, foo: [{1}]&#34;</span>,
            Counter,
            <span style=color:#66d9ef>string</span>.Join(<span style=color:#e6db74>&#34;, &#34;</span>, Foo));
    }
}
</code></pre></div><p>The following Javascript code can consume events published by the code above:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>on_topic1</span>(<span style=color:#a6e22e>args</span>, <span style=color:#a6e22e>kwargs</span>) {
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;com.myapp.topic1: Got event:&#34;</span>, <span style=color:#a6e22e>args</span>, <span style=color:#a6e22e>kwargs</span>);
}

<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>on_topic2</span>(<span style=color:#a6e22e>args</span>, <span style=color:#a6e22e>kwargs</span>) {
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;com.myapp.topic2: Got event:&#34;</span>, <span style=color:#a6e22e>args</span>, <span style=color:#a6e22e>kwargs</span>);
}

<span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>subscribe</span>(<span style=color:#e6db74>&#39;com.myapp.topic1&#39;</span>, <span style=color:#a6e22e>on_topic1</span>);
<span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>subscribe</span>(<span style=color:#e6db74>&#39;com.myapp.topic2&#39;</span>, <span style=color:#a6e22e>on_topic2</span>);
</code></pre></div><blockquote><p>This example is based on <a href=https://github.com/tavendo/AutobahnPython/tree/master/examples/twisted/wamp/pubsub/complex>this</a> AutobahnJS sample.</p></blockquote><h2 id=other-features>Other features</h2><h3 id=instance-providers-for-reflection-based-callee>Instance providers for reflection-based callee</h3><p>From this version, new overloads for IWampRealmServiceProvider&rsquo;s RegisterCallee method were added. These overloads allow you to specify an instance provider for your callee service instance, that is a Func&lt;> delegate that returns an instance of your callee service provider.</p><p>This allows you to control yourself the lifecycle of the callee service instance. You can of course use an dependency injection framework to help you manage that.</p><p>For instance, using <a href=http://www.ninject.org/>Ninject</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> Task Run()
{
    IKernel kernel = <span style=color:#66d9ef>new</span> StandardKernel();

    kernel.Bind&lt;IAddCalculator&gt;().To&lt;Calculator&gt;();

    DefaultWampChannelFactory factory = <span style=color:#66d9ef>new</span> DefaultWampChannelFactory();

	IWampChannel channel =
		factory.CreateJsonChannel(<span style=color:#e6db74>&#34;ws://127.0.0.1:8080/ws&#34;</span>, <span style=color:#e6db74>&#34;realm1&#34;</span>);

	<span style=color:#66d9ef>await</span> channel.Open();

    <span style=color:#66d9ef>await</span> channel.RealmProxy.Services.RegisterCallee(() =&gt; kernel.Get&lt;IAddCalculator&gt;());
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> IAddCalculator
{
<span style=color:#a6e22e>    [WampProcedure(&#34;com.arguments.add2&#34;)]</span>
    <span style=color:#66d9ef>int</span> Add2(<span style=color:#66d9ef>int</span> x, <span style=color:#66d9ef>int</span> y);
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Calculator</span> : IAddCalculator
{
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> Add2(<span style=color:#66d9ef>int</span> x, <span style=color:#66d9ef>int</span> y)
    {
        <span style=color:#66d9ef>return</span> (x + y);
    }
}
</code></pre></div><blockquote><p>Note: if you&rsquo;re using Ninject, you&rsquo;re recomended to use <a href=https://github.com/ninject/Ninject.Extensions.Factory>Ninject.Extensions.Factory</a> which allows you to get typed factories instances or Func&lt;> instances without being aware about the dependency injection container.</p></blockquote><h3 id=net-standard-websocket4net-support>.NET Standard WebSocket4Net support</h3><p><a href=https://github.com/kerryjiang/WebSocket4Net>WebSocket4Net</a> has been ported to .NET Standard 1.3 recently. From this version WampSharp.WebSocket4Net is supported for .NET Standard 1.3 as well.</p><p>This could be an alternative for running WampSharp over WebSockets on non-Windows platforms for now, until an update for .NET Core which supports WebSockets on non-Windows platforms is released.</p><h3 id=structured-logging>Structured logging</h3><p>From this version, some formatted logs are written using <a href=https://github.com/serilog/serilog/wiki/Structured-Data>structured logging</a>. These include properties such as session ids, incoming WAMP Json/MsgPack messages and more. This feature can be leveraged by <a href=https://serilog.net/>Serilog</a>.</p></section></article></main></div><div class="col-sm-3 col-sm-offset-1 doc-sidebar"><div id=sidebar><div class=sidebar-module><div class=sidebar-toc><h4 class=sidebar-heading>Table of Contents</h4><ul><li><strong><a href=#title>WampSharp v1.2.5.21-beta release notes</a></strong></li></ul><nav id=TableOfContents><ul><li><a href=#c-70-tuples-support>C# 7.0 tuples support</a><ul><li><a href=#reflection-based-callee-tuples-support>Reflection-based callee tuples support</a></li><li><a href=#reflection-based-caller-tuples-support>Reflection-based caller tuples support</a></li><li><a href=#rx-based-publishsubscribe-tuples-support>Rx-based publish/subscribe tuples support</a></li></ul></li><li><a href=#other-features>Other features</a><ul><li><a href=#instance-providers-for-reflection-based-callee>Instance providers for reflection-based callee</a></li><li><a href=#net-standard-websocket4net-support>.NET Standard WebSocket4Net support</a></li><li><a href=#structured-logging>Structured logging</a></li></ul></li></ul></nav></div></div><div class=sidebar-module><h4 class=sidebar-heading>Pages in Categories</h4><ul class=sidebar-category-list><li><a href=https://wampsharp.net/categories/authentication><span class=doc-list-category>Authentication</span></a><ul><li><a href=/wamp2/client/client-side-authentication/>Client-side authentication</a></li><li><a href=/wamp2/router/cookie-based-router-side-authentication/>Cookie based router-side authentication</a></li><li><a href=/wamp2/router/router-side-authentication/>Router-side authentication</a></li><li><a href=/wamp2/client/wamp-cra-client-side-authentication/>WAMP-CRA client side authentication</a></li><li><a href=/wamp2/router/wamp-cra-router-side-authentication/>WAMP-CRA router-side authentication</a></li></ul></li><li><a href=https://wampsharp.net/categories/callee><span class=doc-list-category>Callee</span></a><ul><li><a href=/wamp2/roles/callee/getting-started-with-callee/>Getting started with Callee</a></li><li><a href=/wamp2/roles/callee/raw-callee/>Raw Callee</a></li><li><a href=/wamp2/roles/callee/reflection-based-callee/>Reflection-based Callee</a></li></ul></li><li><a href=https://wampsharp.net/categories/caller><span class=doc-list-category>Caller</span></a><ul><li><a href=/wamp2/roles/caller/getting-started-with-caller/>Getting started with Caller</a></li><li><a href=/wamp2/roles/caller/raw-caller/>Raw Caller</a></li><li><a href=/wamp2/roles/caller/reflection-based-caller/>Reflection-based Caller</a></li></ul></li><li><a href=https://wampsharp.net/categories/client><span class=doc-list-category>Client</span></a><ul><li><a href=/wamp2/router/transports/rawsocket/>RawSocket transport</a></li><li><a href=/wamp2/client/client-side-authentication/>Client-side authentication</a></li><li><a href=/wamp2/meta-api-service/>Meta-api descriptor service</a></li><li><a href=/wamp2/testament-service/>Testament service</a></li><li><a href=/wamp2/client/wamp-cra-client-side-authentication/>WAMP-CRA client side authentication</a></li><li><a href=/wamp2/client/wampchannel/>WampChannel</a></li><li><a href=/wamp2/client/wampchannelreconnector/>WampChannelReconnector</a></li></ul></li><li><a href=https://wampsharp.net/categories/getting-started><span class=doc-list-category>Getting-Started</span></a><ul><li><a href=/wamp2/roles/callee/getting-started-with-callee/>Getting started with Callee</a></li><li><a href=/wamp2/roles/caller/getting-started-with-caller/>Getting started with Caller</a></li><li><a href=/wamp2/roles/publisher/getting-started-with-publisher/>Getting started with Publisher</a></li><li><a href=/wamp2/roles/subscriber/getting-started-with-subscriber/>Getting started with Subscriber</a></li><li><a href=/wamp2/getting-started-with-wampv2/>Getting started with WAMPv2</a></li></ul></li><li><a href=https://wampsharp.net/categories/publisher><span class=doc-list-category>Publisher</span></a><ul><li><a href=/wamp2/roles/publisher/getting-started-with-publisher/>Getting started with Publisher</a></li><li><a href=/wamp2/roles/publisher/raw-publisher/>Raw Publisher</a></li><li><a href=/wamp2/roles/publisher/reflection-based-publisher/>Reflection-based Publisher</a></li><li><a href=/wamp2/roles/publisher/rx-based-publisher/>Rx-based Publisher</a></li></ul></li><li><a href=https://wampsharp.net/categories/release-notes><span class=doc-list-category>Release-Notes</span></a><ul><li><a href=/release-notes/wampsharp-v20.1.1-release-notes/>WampSharp v20.1.1 release notes</a></li><li><a href=/release-notes/wampsharp-v18.6.1-release-notes/>WampSharp v18.6.1 release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.6.41-beta-release-notes/>WampSharp v1.2.6.41-beta release notes</a></li><li><span class=active>WampSharp v1.2.5.21-beta release notes</span></li><li><a href=/release-notes/wampsharp-v1.2.4.18-beta-release-notes/>WampSharp v1.2.4.18-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.3.12-beta-release-notes/>WampSharp v1.2.3.12-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.2.8-beta-release-notes/>WampSharp v1.2.2.8-beta release notes</a></li><li><a href=/release-notes/wampsharp-v1.2.1.6-beta-release-notes/>WampSharp v1.2.1.6-beta release notes</a></li></ul></li><li><a href=https://wampsharp.net/categories/roadmap><span class=doc-list-category>Roadmap</span></a><ul><li><a href=/roadmap/>Roadmap</a></li></ul></li><li><a href=https://wampsharp.net/categories/router><span class=doc-list-category>Router</span></a><ul><li><a href=/wamp2/router/transports/rawsocket/>RawSocket transport</a></li><li><a href=/wamp2/router/transports/websocket/>WebSocket transports</a></li><li><a href=/wamp2/router/cookie-based-router-side-authentication/>Cookie based router-side authentication</a></li><li><a href=/wamp2/meta-api-service/>Meta-api descriptor service</a></li><li><a href=/wamp2/router/router-side-authentication/>Router-side authentication</a></li><li><a href=/wamp2/testament-service/>Testament service</a></li><li><a href=/wamp2/router/wamp-cra-router-side-authentication/>WAMP-CRA router-side authentication</a></li><li><a href=/wamp2/router/wamphost/>WampHost</a></li></ul></li><li><a href=https://wampsharp.net/categories/subscriber><span class=doc-list-category>Subscriber</span></a><ul><li><a href=/wamp2/roles/subscriber/getting-started-with-subscriber/>Getting started with Subscriber</a></li><li><a href=/wamp2/roles/subscriber/raw-subscriber/>Raw Subscriber</a></li><li><a href=/wamp2/roles/subscriber/reflection-based-subscriber/>Reflection-based Subscriber</a></li><li><a href=/wamp2/roles/subscriber/rx-based-subscriber/>Rx-based Subscriber</a></li></ul></li><li><a href=https://wampsharp.net/categories/wamp1><span class=doc-list-category>Wamp1</span></a><ul><li><a href=/wamp1/getting-started-with-wampv1/>Getting started with WAMPv1</a></li><li><a href=/wamp1/getting-started-with-wampv1-client/>Getting started with WAMPv1 client</a></li><li><a href=/wamp1/notes-for-wampv1-users/>Notes for WAMP1 users</a></li><li><a href=/wamp1/server-pubsub-hosting-wampv1/>Server PubSub hosting (WAMPv1)</a></li><li><a href=/wamp1/server-rpc-hosting-wampv1/>Server RPC hosting (WAMPv1)</a></li></ul></li></ul></div><div class=sidebar-module><h4 class=sidebar-heading>Tags</h4><div class=tag-box><a class=tag-item href=https://wampsharp.net/tags/authentication>authentication</a>
<a class=tag-item href=https://wampsharp.net/tags/callee>callee</a>
<a class=tag-item href=https://wampsharp.net/tags/caller>caller</a>
<a class=tag-item href=https://wampsharp.net/tags/client>client</a>
<a class=tag-item href=https://wampsharp.net/tags/publisher>publisher</a>
<a class=tag-item href=https://wampsharp.net/tags/raw-api>raw-api</a>
<a class=tag-item href=https://wampsharp.net/tags/reflection>reflection</a>
<a class=tag-item href=https://wampsharp.net/tags/roadmap>roadmap</a>
<a class=tag-item href=https://wampsharp.net/tags/router>router</a>
<a class=tag-item href=https://wampsharp.net/tags/rx>rx</a>
<a class=tag-item href=https://wampsharp.net/tags/services>services</a>
<a class=tag-item href=https://wampsharp.net/tags/subscriber>subscriber</a>
<a class=tag-item href=https://wampsharp.net/tags/transports>transports</a>
<a class=tag-item href=https://wampsharp.net/tags/wamp1>wamp1</a>
<a class=tag-item href=https://wampsharp.net/tags/wampcra>wampcra</a></div></div></div></div></div><hr><div class=row><div class=col-sm-8><p class=doc-footer-em><a href=# onclick=resetSidebarPos()>Back to TOP</a></p></div></div></div><footer class=doc-footer><p class=doc-footer-em>Browse <strong><a href=https://github.com/Code-Sharp/WampSharp.net/>Repository</a></strong></p><p>Copyright (c) 2013-2020, Elad Zelingher; All rights reserved.</p><p>Powered by <strong><a href=https://github.com/progrhyme/hugo-theme-bootie-docs>Bootie Docs</a></strong> - theme for <a href=http://gohugo.io/>Hugo</a> by <a href=https://github.com/progrhyme/>progrhyme</a>.</p></footer><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-98663639-2','auto');ga('send','pageview');</script><script src=https://wampsharp.net/js/jquery.min.js></script><script src=https://wampsharp.net/js/bootstrap.min.js></script><script src=https://wampsharp.net/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script src=https://wampsharp.net/js/ie10-viewport-bug-workaround.js></script><script src=https://wampsharp.net/js/bootie-docs.js></script></body></html>